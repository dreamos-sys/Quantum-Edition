<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dream OS v13.1.2 â€” Al-Fikri</title>
  
  <!-- FAVICON & PWA -->
  <link rel="apple-touch-icon" sizes="180x180" href="/Quantum-Edition/assets/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/Quantum-Edition/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/Quantum-Edition/assets/favicon-16x16.png">
  <link rel="manifest" href="/Quantum-Edition/site.webmanifest">
  <link rel="icon" type="image/png" sizes="192x192" href="/Quantum-Edition/assets/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/Quantum-Edition/assets/android-chrome-512x512.png">
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#00C897" />

  <style>
    :root { --primary: #00C897; --light: #f8fafc; --text: #0f172a; --danger: #ef4444; --warning: #f59e0b; --text-dim: #64748b; }
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',system-ui,sans-serif; }
    body { background:var(--light); color:var(--text); }
    .view { display:none; padding:20px; max-width:600px; margin:0 auto; }
    .view.active { display:block; }
    .view-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:24px; padding-bottom:12px; border-bottom:2px solid var(--primary); }
    .view-title { font-size:1.4rem; font-weight:800; }
    .close-btn { background:none; border:none; font-size:1.8rem; cursor:pointer; color:var(--danger); }
    .btn { display:flex; align-items:center; gap:12px; width:100%; padding:14px; margin:12px 0; border:none; border-radius:12px; font-weight:700; cursor:pointer; }
    .btn-primary { background:var(--primary); color:white; }
    .btn-danger { background:var(--danger); color:white; }
    .btn-warning { background:var(--warning); color:white; }
    .btn-secondary { background:var(--text-dim); color:white; }
    .form-group { margin:16px 0; }
    .form-label { display:block; margin-bottom:8px; font-weight:600; }
    .form-input, .form-textarea { width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; font-size:1rem; }
    .form-textarea { min-height:100px; resize:vertical; }
    .info-box { background:rgba(59,130,246,0.1); padding:16px; border-radius:12px; margin:20px 0; font-size:0.9rem; }
    .table-container { overflow-x:auto; margin:20px 0; }
    .xl-table { width:100%; border-collapse:collapse; margin-top:10px; }
    .xl-table th, .xl-table td { border:1px solid #ddd; padding:10px; text-align:left; }
    .xl-table th { background:var(--primary); color:white; }
    .navbar { display:flex; position:fixed; bottom:0; left:0; right:0; background:white; border-top:1px solid #eee; padding:10px 0; }
    .nav-item { flex:1; text-align:center; font-size:0.85rem; padding:6px 0; color:var(--text-dim); cursor:pointer; }
    .nav-item.active { color:var(--primary); font-weight:700; }
  </style>
</head>
<body>

  <!-- MAIN VIEW -->
  <div id="mainView" class="view active">
    <div class="view-header"><div class="view-title">DREAM OS v13.1.2</div></div>
    <button class="btn btn-primary" onclick="showView('booking')">ğŸ“… BOOKING SARANA</button>
    <button class="btn btn-danger" onclick="showView('k3')">ğŸ›¡ï¸ LAPORAN K3</button>
    <button class="btn btn-warning" onclick="showView('security')">ğŸ‘® LAPORAN SEKURITI</button>
    <button class="btn btn-secondary" onclick="showView('admin')">ğŸ‘‘ ADMIN PANEL</button>
    <div class="info-box">
      <div style="color:#3b82f6;font-weight:800;margin-bottom:8px;">ğŸ“¡ QUANTUM SYNC ACTIVE</div>
      <div style="color:var(--text-dim);">
        â€¢ Offline-first support<br>â€¢ Real-time ke dashboard Pak Erwin<br>â€¢ Kompatibel semua device (A12+)
      </div>
    </div>
  </div>

  <!-- BOOKING VIEW -->
  <div id="bookingView" class="view">
    <div class="view-header"><div class="view-title">ğŸ“… BOOKING SARANA</div><button class="close-btn" onclick="showView('main')">Ã—</button></div>
    <div class="form-group"><label class="form-label">Pilih Sarana</label>
      <select class="form-input" id="bookingSarana">
        <option value="">-- Pilih --</option>
        <option value="Aula SMP">Aula SMP</option>
        <option value="Aula SMA">Aula SMA</option>
        <option value="Lapangan Futsal">Lapangan Futsal</option>
        <option value="Labkom SD">Labkom SD</option>
        <option value="Labkom SMP">Labkom SMP</option>
        <option value="Labkom SMA">Labkom SMA</option>
        <option value="Perpus SD">Perpus SD</option>
        <option value="Perpus SMP">Perpus SMP</option>
        <option value="Perpus SMA">Perpus SMA</option>
        <option value="Kantin SMP">Kantin SMP</option>
        <option value="Kantin SMA">Kantin SMA</option>
        <option value="Masjid">Masjid</option>
        <option value="Musholla SMA">Musholla SMA</option>
        <option value="Lapangan Basket">Lapangan Basket</option>
        <option value="Lapangan Volley">Lapangan Volley</option>
        <option value="Lapangan Rumput">Lapangan Rumput</option>
        <option value="Area Parkir Loby SMA">Area Parkir Loby SMA</option>
      </select>
    </div>
    <div class="form-group"><label>Nama PIC</label><input type="text" class="form-input" placeholder="Nama lengkap"></div>
    <div class="form-group"><label>No HP</label><input type="text" class="form-input" placeholder="0812..."></div>
    <div class="form-group"><label>Unit</label>
      <select class="form-input">
        <option value="SD">SD Al Fikri</option>
        <option value="SMP">SMP Al Fikri</option>
        <option value="SMA">SMA Al Fikri</option>
        <option value="Umum">Umum</option>
      </select>
    </div>
    <button class="btn btn-primary" onclick="submitBooking()">KIRIM KE SISTEM</button>
  </div>

  <!-- K3 VIEW -->
  <div id="k3View" class="view">
    <div class="view-header"><div class="view-title">ğŸ›¡ï¸ LAPORAN K3</div><button class="close-btn" onclick="showView('main')">Ã—</button></div>
    <div class="form-group"><label>Jenis Laporan</label>
      <select class="form-input" id="k3Type">
        <option value="Kerusakan">Kerusakan â†’ Maintenance</option>
        <option value="Kehilangan">Kehilangan â†’ Sekuriti</option>
        <option value="Kebersihan">Kebersihan â†’ CS</option>
      </select>
    </div>
    <div class="form-group"><label>Lokasi</label><input type="text" class="form-input" placeholder="Contoh: Aula SMA"></div>
    <div class="form-group"><label>Deskripsi</label><textarea class="form-input" placeholder="Jelaskan kejadian..."></textarea></div>
    <button class="btn btn-danger" onclick="submitK3()">KIRIM KE SISTEM</button>
  </div>

  <!-- SECURITY VIEW -->
  <div id="securityView" class="view">
    <div class="view-header"><div class="view-title">ğŸ‘® LAPORAN HARIAN SEKURITI</div><button class="close-btn" onclick="showView('main')">Ã—</button></div>
    <div class="form-group"><label>Petugas Jaga (3 Orang)</label>
      <input type="text" class="form-input" placeholder="Petugas 1">
      <input type="text" class="form-input" placeholder="Petugas 2">
      <input type="text" class="form-input" placeholder="Petugas 3">
    </div>
    <div class="form-group"><label>Shift</label>
      <select class="form-input" id="shiftSelect">
        <option value="pagi">â˜€ï¸ Pagi (07:00â€“19:00)</option>
        <option value="malam">ğŸŒ™ Malam (19:00â€“07:00)</option>
      </select>
    </div>
    <div class="table-container">
      <table class="xl-table">
        <thead><tr><th>No</th><th>Jam</th><th>Uraian Kegiatan / Temuan</th><th>Keterangan</th></tr></thead>
        <tbody id="securityTableBody">
          <tr>
            <td>1</td>
            <td><input type="time" class="form-input" style="width:100px;" value="08:00"></td>
            <td><input type="text" class="form-input" placeholder="Kontrol area Aula SMA..."></td>
            <td><input type="text" class="form-input" placeholder="Normal"></td>
          </tr>
        </tbody>
      </table>
      <button class="btn btn-secondary" style="margin-top:10px;" onclick="addSecurityRow()">+ Tambah Baris</button>
    </div>
    <button class="btn btn-warning" onclick="generateExcel()">ğŸ“Š EKSPOR KE EXCEL</button>
    <button class="btn btn-primary" onclick="submitSecurity()">ğŸ“¡ SIMPAN KE SISTEM</button>
  </div>

  <!-- ADMIN VIEW -->
  <div id="adminView" class="view">
    <div class="view-header"><div class="view-title">ğŸ‘‘ ADMIN PANEL</div><button class="close-btn" onclick="showView('main')">Ã—</button></div>
    <div class="form-group"><label>Password Admin</label><input type="password" class="form-input" id="adminPass" placeholder="4dm1n_AF6969@00"><span onclick="togglePass('adminPass')" style="cursor:pointer;margin-left:-25px;">ğŸ‘ï¸</span></div>
    <button class="btn btn-secondary" onclick="loginAdmin()">MASUK</button>
  </div>

  <!-- NAVBAR -->
  <div class="navbar">
    <div class="nav-item active" onclick="showView('main')">ğŸ </div>
    <div class="nav-item" onclick="showView('booking')">ğŸ“…</div>
    <div class="nav-item" onclick="showView('k3')">ğŸ›¡ï¸</div>
    <div class="nav-item" onclick="showView('security')">ğŸ‘®</div>
  </div>

  <!-- SCRIPTS -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    
    // âœ… SUDAH DIISI OTOMATIS DARI DATA LU!
    const supabaseUrl = 'https://pzsabdxnadpwqlirzjgg.supabase.co';
    const supabaseAnonKey = 'sb_publishable_mvF2dA76kr82_79SYpgwyg_zNobsFJ2';
    const supabase = createClient(supabaseUrl, supabaseAnonKey);

    const views = ['main','booking','k3','security','admin'];
    function showView(id) {
      views.forEach(v => document.getElementById(v+'View').classList.remove('active'));
      document.getElementById(id+'View').classList.add('active');
    }
    function togglePass(id) {
      const i = document.getElementById(id);
      i.type = i.type === 'password' ? 'text' : 'password';
    }
    function isWorkHours() {
      const d = new Date(), day = d.getDay();
      if (day===0||day===6) return false;
      const h = d.getHours(), m = d.getMinutes();
      return h + (m/60) >= 7.5 && h + (m/60) <= 16.0;
    }
    function checkAccess(t) {
      if (t!=='security' && !isWorkHours()) {
        alert("âš ï¸ AKSES DIBLOKIR: Booking & K3 hanya 07:30-16:00 (Senin-Jumat).");
        return false;
      }
      return true;
    }
    let loginAttempts=0,isLocked=false;
    function loginAdmin() {
      if (isLocked) { alert("ğŸš« SISTEM TERKUNCI: Tunggu 5 menit."); return; }
      if (document.getElementById('adminPass').value==='4dm1n_AF6969@00') {
        localStorage.setItem('dreamos_device_id', btoa(navigator.userAgent));
        alert("ğŸ‘‘ Selamat datang, Sayyidina!");
        loginAttempts=0; showView('main');
      } else {
        loginAttempts++;
        if (loginAttempts>=3) {
          isLocked=true;
          setTimeout(()=>{isLocked=false;loginAttempts=0;},300000);
          alert("âŒ 3x Salah! Sistem dikunci 5 menit.");
        } else alert(`âŒ Password salah! Sisa: ${3-loginAttempts}`);
      }
    }
    function addSecurityRow() {
      const t=document.getElementById('securityTableBody'), r=t.insertRow(), n=t.rows.length;
      r.innerHTML=`<td>${n}</td><td><input type="time" class="form-input" style="width:100px;"></td><td><input type="text" class="form-input" placeholder="Contoh: Kontrol area Aula SMA..."></td><td><input type="text" class="form-input" placeholder="Normal / Terdata / Waspada"></td>`;
    }
    function generateExcel() {
      const ws=XLSX.utils.aoa_to_sheet([["LAPORAN HARIAN SEKURITI - AL-FIKRI"],[],["No","Jam","Uraian","Keterangan"]]);
      let r=3; document.querySelectorAll('#securityTableBody tr').forEach(tr=>{
        const c=tr.querySelectorAll('input');
        ws[`A${r}`]={v:tr.cells[0].textContent,t:'s'}; ws[`B${r}`]={v:c[0]?.value||'',t:'s'};
        ws[`C${r}`]={v:c[1]?.value||'',t:'s'}; ws[`D${r}`]={v:c[2]?.value||'',t:'s'}; r++;
      });
      ws['!merges']=[{s:{r:0,c:0},e:{r:0,c:3}}]; ws['A1'].s={font:{bold:true,sz:14,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"00C897"}},alignment:{horizontal:"center"}};
      XLSX.writeFile(XLSX.utils.book_new().Sheets={"Laporan Harian":ws},"Laporan_Sekuriti_"+new Date().toLocaleDateString('id-ID').replace(/\//g,'_')+".xlsx");
    }
    async function submitToSupabase(t,d) {
      try {
        const {error}=await supabase.from(t).insert(d);
        if(!error) alert("âœ… Data berhasil dikirim ke sistem!");
        else throw error;
      } catch(e) {
        localStorage.setItem(`queue_${Date.now()}`,JSON.stringify({t,d}));
        alert("ğŸ“¶ Offline! Data akan dikirim saat online.");
      }
      showView('main');
    }
    function submitBooking() {
      if(!checkAccess('booking')) return;
      submitToSupabase('booking_sarana',{
        sarana:document.getElementById('bookingSarana').value,
        pic:document.querySelector('#bookingView input[placeholder="Nama lengkap"]').value,
        phone:document.querySelector('#bookingView input[placeholder="0812..."]').value,
        unit:document.querySelector('#bookingView select').value
      });
    }
    function submitK3() {
      if(!checkAccess('k3')) return;
      submitToSupabase('laporan_k3',{
        type:document.getElementById('k3Type').value,
        location:document.querySelector('#k3View input[placeholder="Contoh: Aula SMA"]').value,
        description:document.querySelector('#k3View textarea').value
      });
    }
    function submitSecurity() {
      const e=[]; document.querySelectorAll('#securityTableBody tr').forEach(r=>{
        const c=r.querySelectorAll('input');
        e.push({jam:c[0]?.value||'',uraian:c[1]?.value||'',keterangan:c[2]?.value||''});
      });
      submitToSupabase('laporan_sekuriti',{
        petugas_1:document.querySelectorAll('#securityView input')[0].value,
        petugas_2:document.querySelectorAll('#securityView input')[1].value,
        petugas_3:document.querySelectorAll('#securityView input')[2].value,
        shift:document.getElementById('shiftSelect').value,
        entries:JSON.stringify(e)
      });
    }
    if('serviceWorker' in navigator) {
      window.addEventListener('load',()=>{
        navigator.serviceWorker.register('/Quantum-Edition/sw.js').catch(console.log);
      });
    }
    if(!localStorage.getItem('dreamos_device_id')) {
      localStorage.setItem('dreamos_device_id',btoa(navigator.userAgent));
    }
  </script>
</body>
</html>
