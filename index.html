<!DOCTYPE html>
<html lang="id" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#10b981">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Dream OS Quantum">
    <meta name="application-name" content="Dream OS Quantum">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="Enterprise Management System - SIF Al Fikri - ISO 27001 Certified PWA">
    <meta name="keywords" content="school management, enterprise, PWA, SIF Al Fikri, Dream OS">
    <meta name="author" content="Dream Team - The Power Soul of Shalawat">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Dream OS Quantum v4.2">
    <meta property="og:description" content="Enterprise Management System with ISO 27001 Security Standards">
    <meta property="og:image" content="https://dreamos.sif-alfikri.sch.id/icons/icon-512x512.png">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Dream OS Quantum">
    <meta name="twitter:description" content="Next Generation School Management System">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" crossorigin="use-credentials">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Amiri:wght@400;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    
    <title>Dream OS Quantum v4.2 - SIF Al Fikri Enterprise System</title>
    
    <style>
        /* =========== SYSTEM VARIABLES - ISO COMPLIANT =========== */
        :root {
            /* ISO 27001 Security Colors */
            --iso-primary: #10b981;      /* Security Verified */
            --iso-secondary: #3b82f6;    /* Information Integrity */
            --iso-success: #059669;      /* Compliance Passed */
            --iso-warning: #f59e0b;      /* Warning Level 1 */
            --iso-danger: #dc2626;       /* Critical Alert */
            --iso-info: #0ea5e9;         /* Information Status */
            
            /* Dark Mode ISO Compliant */
            --iso-bg-primary: #0f172a;   /* Main Background */
            --iso-bg-secondary: #1e293b; /* Card Background */
            --iso-bg-tertiary: #334155;  /* Input Background */
            
            /* Text Colors - WCAG AAA Compliant */
            --iso-text-primary: #f8fafc; /* 7:1 Contrast Ratio */
            --iso-text-secondary: #cbd5e1; /* 5.5:1 Contrast Ratio */
            --iso-text-tertiary: #94a3b8; /* 4.5:1 Contrast Ratio */
            
            /* Border Colors */
            --iso-border-primary: #475569;
            --iso-border-secondary: #64748b;
            
            /* Arabic Theme */
            --arabic-bg: linear-gradient(135deg, #1a472a 0%, #14532d 100%);
            --arabic-gold: #fbbf24;
            
            /* Shadows - ISO Visual Hierarchy */
            --shadow-iso-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-iso-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-iso-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-iso-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            /* Border Radius - ISO Accessibility */
            --radius-iso-sm: 0.375rem;
            --radius-iso-md: 0.5rem;
            --radius-iso-lg: 0.75rem;
            --radius-iso-xl: 1rem;
            
            /* Transitions - ISO UX Standards */
            --transition-iso-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-iso-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-iso-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Z-index Hierarchy */
            --z-iso-dropdown: 1000;
            --z-iso-sticky: 1020;
            --z-iso-fixed: 1030;
            --z-iso-modal-backdrop: 1040;
            --z-iso-modal: 1050;
            --z-iso-popover: 1060;
            --z-iso-tooltip: 1070;
            --z-iso-toast: 1080;
        }
        
        /* =========== CSS RESET - ISO SECURITY STANDARD =========== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        html {
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
            -moz-text-size-adjust: 100%;
            text-size-adjust: 100%;
            font-size: 16px;
        }
        
        body {
            font-family: 'Poppins', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--iso-bg-primary);
            color: var(--iso-text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            text-rendering: optimizeLegibility;
        }
        
        /* =========== ARABIC HEADER - MULTILINGUAL SUPPORT =========== */
        .arabic-header {
            background: var(--arabic-bg);
            color: white;
            text-align: center;
            padding: 1.5rem 1rem;
            margin: 0 0 2rem 0;
            border-bottom: 3px solid var(--arabic-gold);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-iso-xl);
        }
        
        .arabic-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(21, 128, 61, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .arabic-text {
            font-family: 'Amiri', 'Traditional Arabic', serif;
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1.8;
            color: var(--arabic-gold);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }
        
        .arabic-translation {
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            color: #d1fae5;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .arabic-separator {
            width: 200px;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--arabic-gold), transparent);
            margin: 1.5rem auto;
            border-radius: 3px;
            opacity: 0.7;
        }
        
        /* =========== MAIN CONTAINER =========== */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        /* =========== SYSTEM HEADER =========== */
        .system-header {
            background: var(--iso-bg-secondary);
            border-radius: var(--radius-iso-xl);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 2px solid var(--iso-border-primary);
            box-shadow: var(--shadow-iso-lg);
            position: relative;
            overflow: hidden;
        }
        
        .system-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, var(--iso-primary) 0%, var(--iso-secondary) 100%);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: transform var(--transition-iso-normal);
        }
        
        .logo-section:hover {
            transform: translateY(-2px);
        }
        
        .logo-icon {
            font-size: 3rem;
            color: var(--iso-primary);
            filter: drop-shadow(0 4px 6px rgba(16, 185, 129, 0.3));
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
        }
        
        .system-title {
            font-size: 1.75rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--iso-primary) 0%, var(--iso-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }
        
        .system-subtitle {
            color: var(--iso-text-tertiary);
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        /* =========== AUTH SECTION =========== */
        .auth-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .auth-btn {
            background: linear-gradient(135deg, var(--iso-primary) 0%, var(--iso-secondary) 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-iso-lg);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all var(--transition-iso-normal);
            box-shadow: var(--shadow-iso-md);
        }
        
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-iso-lg);
        }
        
        .auth-btn:active {
            transform: translateY(0);
        }
        
        .user-badge {
            background: var(--iso-bg-tertiary);
            padding: 0.75rem 1.25rem;
            border-radius: var(--radius-iso-lg);
            border: 2px solid var(--iso-border-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideInRight 0.3s ease;
            position: relative;
        }
        
        .user-badge::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: var(--radius-iso-lg);
            background: linear-gradient(135deg, var(--iso-primary) 0%, var(--iso-secondary) 100%);
            z-index: -1;
            opacity: 0.5;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--iso-primary) 0%, var(--iso-secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            border: 2px solid white;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-role {
            font-weight: 700;
            color: var(--iso-primary);
            font-size: 0.875rem;
        }
        
        .user-status {
            font-size: 0.75rem;
            color: var(--iso-text-tertiary);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .logout-btn {
            background: transparent;
            border: 1px solid var(--iso-border-primary);
            color: var(--iso-text-tertiary);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-iso-md);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all var(--transition-iso-fast);
        }
        
        .logout-btn:hover {
            border-color: var(--iso-danger);
            color: var(--iso-danger);
        }
        
        /* =========== DASHBOARD GRID =========== */
        .dashboard-section {
            margin-bottom: 3rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--iso-border-primary);
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--iso-text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .section-icon {
            color: var(--iso-primary);
            font-size: 1.5rem;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        /* =========== ISO COMPLIANT CARDS =========== */
        .dashboard-card {
            background: var(--iso-bg-secondary);
            border-radius: var(--radius-iso-xl);
            padding: 1.75rem;
            border: 2px solid transparent;
            transition: all var(--transition-iso-normal);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-iso-lg);
        }
        
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, var(--iso-primary) 0%, var(--iso-secondary) 100%);
            transform: scaleX(0);
            transition: transform var(--transition-iso-normal);
            transform-origin: left;
        }
        
        .dashboard-card:hover {
            transform: translateY(-8px);
            border-color: var(--iso-primary);
            box-shadow: var(--shadow-iso-xl);
        }
        
        .dashboard-card:hover::before {
            transform: scaleX(1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--iso-primary);
            transition: transform var(--transition-iso-normal);
        }
        
        .dashboard-card:hover .card-icon {
            transform: scale(1.1) rotate(5deg);
        }
        
        .card-shortcut {
            background: rgba(16, 185, 129, 0.1);
            color: var(--iso-primary);
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--iso-text-primary);
        }
        
        .card-description {
            color: var(--iso-text-tertiary);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            flex-grow: 1;
        }
        
        .card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid var(--iso-border-primary);
        }
        
        .card-status {
            font-size: 0.75rem;
            color: var(--iso-text-tertiary);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .card-arrow {
            color: var(--iso-primary);
            font-size: 1rem;
            transition: transform var(--transition-iso-fast);
        }
        
        .dashboard-card:hover .card-arrow {
            transform: translateX(4px);
        }
        
        /* Card Types - ISO Classification */
        .card-booking { border-left: 4px solid var(--iso-success); }
        .card-k3 { border-left: 4px solid var(--iso-warning); }
        .card-security { border-left: 4px solid var(--iso-info); }
        .card-admin { border-left: 4px solid var(--iso-primary); }
        .card-inventory { border-left: 4px solid #059669; }
        .card-warehouse { border-left: 4px solid #3b82f6; }
        .card-ghost { border-left: 4px solid #fbbf24; }
        
        /* =========== MODAL SYSTEM - ISO ACCESSIBLE =========== */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(8px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: var(--z-iso-modal-backdrop);
            padding: 1rem;
            animation: fadeIn var(--transition-iso-normal);
        }
        
        .modal-backdrop.active {
            display: flex;
        }
        
        .modal-container {
            background: var(--iso-bg-secondary);
            border-radius: var(--radius-iso-xl);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            border: 2px solid var(--iso-border-primary);
            box-shadow: var(--shadow-iso-xl);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* =========== FORM SYSTEM - ISO VALIDATION =========== */
        .form-container {
            display: none;
            background: var(--iso-bg-secondary);
            border-radius: var(--radius-iso-xl);
            border: 2px solid var(--iso-border-primary);
            box-shadow: var(--shadow-iso-xl);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        .form-container.active {
            display: block;
            animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--iso-bg-primary);
            border: 2px solid var(--iso-border-primary);
            border-radius: var(--radius-iso-lg);
            color: var(--iso-text-primary);
            font-family: inherit;
            font-size: 1rem;
            transition: all var(--transition-iso-fast);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--iso-primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        
        /* =========== BUTTON SYSTEM =========== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: var(--radius-iso-lg);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-iso-normal);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--iso-primary) 0%, var(--iso-secondary) 100%);
            color: white;
            box-shadow: var(--shadow-iso-md);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-iso-lg);
        }
        
        /* =========== NOTIFICATION SYSTEM =========== */
        .notification-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: var(--z-iso-toast);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-width: 400px;
            width: 100%;
        }
        
        .notification {
            background: var(--iso-bg-secondary);
            border-left: 4px solid var(--iso-primary);
            border-radius: var(--radius-iso-lg);
            padding: 1rem 1.25rem;
            box-shadow: var(--shadow-iso-xl);
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            transform: translateX(400px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideInRight 0.3s ease forwards;
        }
        
        /* =========== LOADING OVERLAY =========== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(4px);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: var(--z-iso-modal);
            animation: fadeIn var(--transition-iso-normal);
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(16, 185, 129, 0.1);
            border-top: 4px solid var(--iso-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1.5rem;
        }
        
        /* =========== STATUS BAR - ISO COMPLIANT =========== */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--iso-bg-secondary);
            padding: 0.75rem 1.5rem;
            border-top: 2px solid var(--iso-border-primary);
            z-index: var(--z-iso-sticky);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .connection-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--iso-success);
            position: relative;
        }
        
        .connection-dot::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--iso-success);
            opacity: 0.3;
            transform: translate(-50%, -50%);
            animation: pulse 2s infinite;
        }
        
        /* =========== MULTILINGUAL SUPPORT =========== */
        .language-switcher {
            position: fixed;
            top: 1rem;
            left: 1rem;
            display: flex;
            gap: 0.5rem;
            z-index: 1000;
        }
        
        .lang-btn {
            background: var(--iso-bg-tertiary);
            border: 1px solid var(--iso-border-primary);
            color: var(--iso-text-secondary);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-iso-lg);
            cursor: pointer;
            transition: all var(--transition-iso-fast);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .lang-btn.active {
            background: var(--iso-primary);
            color: white;
            border-color: var(--iso-primary);
        }
        
        /* =========== BATTERY SAVER INDICATOR =========== */
        .battery-indicator {
            position: fixed;
            bottom: 4rem;
            right: 1rem;
            background: var(--iso-bg-secondary);
            border: 1px solid var(--iso-border-primary);
            border-radius: var(--radius-iso-lg);
            padding: 0.5rem 1rem;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        /* =========== GPS TRACKER =========== */
        .gps-tracker {
            position: fixed;
            bottom: 4rem;
            left: 1rem;
            background: var(--iso-bg-secondary);
            border: 1px solid var(--iso-border-primary);
            border-radius: var(--radius-iso-lg);
            padding: 0.5rem 1rem;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        /* =========== ANIMATIONS =========== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(40px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.1; }
        }
        
        /* =========== RESPONSIVE DESIGN =========== */
        @media (max-width: 768px) {
            .arabic-text {
                font-size: 1.8rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 0.5rem;
                padding: 0.5rem;
            }
            
            .language-switcher {
                top: 0.5rem;
                left: 0.5rem;
            }
        }
        
        /* =========== RTL SUPPORT =========== */
        [dir="rtl"] .notification {
            border-left: none;
            border-right: 4px solid var(--iso-primary);
        }
        
        [dir="rtl"] .dashboard-card {
            text-align: right;
        }
        
        /* =========== PRINT STYLES =========== */
        @media print {
            .arabic-header,
            .status-bar,
            .language-switcher,
            .battery-indicator,
            .gps-tracker,
            .auth-section {
                display: none !important;
            }
        }
        
        /* =========== ACCESSIBILITY =========== */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* =========== SCROLLBAR STYLING =========== */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--iso-bg-tertiary);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--iso-border-primary);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--iso-primary);
        }
    </style>
</head>
<body>
    <!-- Language Switcher -->
    <div class="language-switcher">
        <button class="lang-btn active" data-lang="id">
            <span>üáÆüá© ID</span>
        </button>
        <button class="lang-btn" data-lang="en">
            <span>üá∫üá∏ EN</span>
        </button>
        <button class="lang-btn" data-lang="ar">
            <span>üá∏üá¶ AR</span>
        </button>
    </div>
    
    <!-- Arabic Header -->
    <div class="arabic-header">
        <div class="arabic-text">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸíŸÖŸê</div>
        <div class="arabic-translation">Dengan menyebut nama Allah Yang Maha Pengasih lagi Maha Penyayang</div>
        
        <div class="arabic-separator"></div>
        
        <div class="arabic-text">ÿßŸéŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸéŸâ ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç ŸàŸéÿπŸéŸÑŸéŸâ ÿ¢ŸÑŸê ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç</div>
        <div class="arabic-translation">Ya Allah, limpahkanlah shalawat kepada junjungan kami Nabi Muhammad dan kepada keluarga junjungan kami Nabi Muhammad</div>
    </div>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- System Header -->
        <header class="system-header">
            <div class="header-content">
                <div class="logo-section" id="logoSection">
                    <div class="logo-icon">üì±</div>
                    <div class="logo-text">
                        <h1 class="system-title">DREAM OS QUANTUM v4.2</h1>
                        <p class="system-subtitle">SIF Al Fikri ‚Ä¢ ISO 27001 Certified ‚Ä¢ Built with ‚ù§Ô∏è by Dream Team</p>
                    </div>
                </div>
                
                <div class="auth-section">
                    <button id="loginBtn" class="auth-btn">
                        <i class="fas fa-sign-in-alt"></i>
                        <span data-i18n="auth.login">System Login</span>
                    </button>
                    
                    <div id="userBadge" class="user-badge hidden">
                        <div class="user-avatar">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div class="user-info">
                            <div class="user-role" id="userRole">Security</div>
                            <div class="user-status">
                                <i class="fas fa-circle"></i>
                                <span>Online ‚Ä¢ </span>
                                <span id="sessionTimer">30:00</span>
                            </div>
                        </div>
                        <button class="logout-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Dashboard Sections -->
        <main class="dashboard-sections">
            <!-- Public Access Section -->
            <section class="dashboard-section" id="publicSection">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-users section-icon"></i>
                        <span data-i18n="sections.public">Public Access</span>
                    </h2>
                    <div class="text-sm text-tertiary" data-i18n="sections.publicDesc">No login required</div>
                </div>
                
                <div class="dashboard-grid">
                    <!-- Booking Card -->
                    <div class="dashboard-card card-booking" id="bookingCard">
                        <div class="card-header">
                            <div class="card-icon">üìÖ</div>
                            <div class="card-shortcut">Alt + B</div>
                        </div>
                        <h3 class="card-title" data-i18n="cards.booking.title">Booking Sarana</h3>
                        <p class="card-description" data-i18n="cards.booking.desc">
                            Sistem pemesanan sarana sekolah dengan kalender pintar dan validasi otomatis.
                        </p>
                        <div class="card-footer">
                            <div class="card-status">
                                <i class="fas fa-circle text-success"></i>
                                <span data-i18n="status.available">Available</span>
                            </div>
                            <div class="card-arrow">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- K3 Report Card -->
                    <div class="dashboard-card card-k3" id="k3Card">
                        <div class="card-header">
                            <div class="card-icon">üõ°Ô∏è</div>
                            <div class="card-shortcut">Alt + K</div>
                        </div>
                        <h3 class="card-title" data-i18n="cards.k3.title">Laporan K3</h3>
                        <p class="card-description" data-i18n="cards.k3.desc">
                            Pelaporan masalah Kesehatan & Keselamatan Kerja dengan dokumentasi visual.
                        </p>
                        <div class="card-footer">
                            <div class="card-status">
                                <i class="fas fa-circle text-success"></i>
                                <span data-i18n="status.cameraReady">Camera Ready</span>
                            </div>
                            <div class="card-arrow">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Security Access Section -->
            <section class="dashboard-section hidden" id="securitySection">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-shield-alt section-icon"></i>
                        <span data-i18n="sections.security">Security Access</span>
                    </h2>
                    <div class="text-sm text-tertiary" data-i18n="sections.securityDesc">Authenticated access required</div>
                </div>
                
                <div class="dashboard-grid">
                    <!-- Security Report Card -->
                    <div class="dashboard-card card-security" id="securityCard">
                        <div class="card-header">
                            <div class="card-icon">üìã</div>
                            <div class="card-shortcut">Alt + S</div>
                        </div>
                        <h3 class="card-title" data-i18n="cards.security.title">Laporan Harian Security</h3>
                        <p class="card-description" data-i18n="cards.security.desc">
                            Sistem pelaporan harian security dengan monitoring peralatan dan kondisi umum.
                        </p>
                        <div class="card-footer">
                            <div class="card-status">
                                <i class="fas fa-circle text-success"></i>
                                <span data-i18n="status.shiftSystem">Shift System</span>
                            </div>
                            <div class="card-arrow">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Admin Access Section -->
            <section class="dashboard-section hidden" id="adminSection">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-cogs section-icon"></i>
                        <span data-i18n="sections.admin">Admin Dashboard</span>
                    </h2>
                    <div class="text-sm text-tertiary" data-i18n="sections.adminDesc">Full system control</div>
                </div>
                
                <div class="dashboard-grid">
                    <!-- Admin Panel Card -->
                    <div class="dashboard-card card-admin" id="adminCard">
                        <div class="card-header">
                            <div class="card-icon">üè¢</div>
                            <div class="card-shortcut">Alt + A</div>
                        </div>
                        <h3 class="card-title" data-i18n="cards.admin.title">Admin Control Panel</h3>
                        <p class="card-description" data-i18n="cards.admin.desc">
                            Dashboard lengkap untuk monitoring, approval, reporting, dan manajemen sistem.
                        </p>
                        <div class="card-footer">
                            <div class="card-status">
                                <i class="fas fa-chart-line text-info"></i>
                                <span data-i18n="status.analytics">Analytics Ready</span>
                            </div>
                            <div class="card-arrow">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Architect Access Section -->
            <section class="dashboard-section hidden" id="architectSection">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-ghost section-icon"></i>
                        <span data-i18n="sections.architect">Architect Mode ‚Ä¢ Mr. M</span>
                    </h2>
                    <div class="text-sm text-tertiary" data-i18n="sections.architectDesc">Master developer access</div>
                </div>
                
                <div class="dashboard-grid">
                    <!-- Ghost Mode Card -->
                    <div class="dashboard-card card-ghost" id="ghostCard">
                        <div class="card-header">
                            <div class="card-icon">üëª</div>
                            <div class="card-shortcut">Alt + G</div>
                        </div>
                        <h3 class="card-title" data-i18n="cards.ghost.title">Ghost Mode Tools</h3>
                        <p class="card-description" data-i18n="cards.ghost.desc">
                            System development tools, database explorer, API simulator, and performance monitoring.
                        </p>
                        <div class="card-footer">
                            <div class="card-status">
                                <i class="fas fa-code text-gold"></i>
                                <span data-i18n="status.developer">Developer Tools</span>
                            </div>
                            <div class="card-arrow">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <!-- Forms Container Section -->
<div class="forms-container">
    <!-- Booking Form -->
    <div class="form-container" id="bookingForm">
        [Booking form existing code...]
    </div>
    
    <!-- K3 Report Form -->
    <div class="form-container" id="k3Form">
        <div class="form-header">
            <h3 class="form-title">
                <i class="fas fa-shield-alt"></i>
                <span data-i18n="forms.k3.title">Form Laporan K3</span>
            </h3>
            <button class="modal-close" onclick="hideAllForms()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="form-body">
            <form id="k3FormElement">
                <div class="form-group">
                    <label for="lokasi" class="form-label">
                        <span data-i18n="forms.k3.location">Lokasi Kejadian</span>
                        <span class="required">*</span>
                    </label>
                    <input type="text" id="lokasi" class="form-control" required>
                </div>
                <div class="flex gap-3">
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-paper-plane"></i>
                        <span data-i18n="forms.submit">Kirim Laporan</span>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="hideAllForms()">
                        <i class="fas fa-times"></i>
                        <span data-i18n="forms.cancel">Batal</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Security Report Form -->
    <div class="form-container" id="securityForm">
        <div class="form-header">
            <h3 class="form-title">
                <i class="fas fa-user-shield"></i>
                <span data-i18n="forms.security.title">Form Laporan Security</span>
            </h3>
            <button class="modal-close" onclick="hideAllForms()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="form-body">
            <form id="securityFormElement">
                <div class="form-group">
                    <label for="shift" class="form-label">
                        <span data-i18n="forms.security.shift">Shift</span>
                        <span class="required">*</span>
                    </label>
                    <select id="shift" class="form-control" required>
                        <option value="">-- Pilih Shift --</option>
                        <option value="pagi">Pagi (07.00-15.00)</option>
                        <option value="sore">Sore (15.00-23.00)</option>
                        <option value="malam">Malam (23.00-07.00)</option>
                    </select>
                </div>
                <div class="flex gap-3">
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-paper-plane"></i>
                        <span data-i18n="forms.submit">Kirim Laporan</span>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="hideAllForms()">
                        <i class="fas fa-times"></i>
                        <span data-i18n="forms.cancel">Batal</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
    
    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-left">
            <button class="back-btn" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
                <span data-i18n="navigation.back">Kembali</span>
            </button>
        </div>
        
        <div class="status-center">
            <div class="mode-indicator">
                <i class="fas fa-user-circle"></i>
                <span id="currentModeText" data-i18n="mode.public">Public Mode</span>
                ‚Ä¢
                <span id="currentTime">--:--</span>
            </div>
        </div>
        
        <div class="status-right">
            <div class="connection-status">
                <div class="connection-dot" id="connectionDot"></div>
                <span class="connection-text" id="connectionText" data-i18n="status.online">Online</span>
            </div>
            <div class="text-xs text-tertiary">
                v4.2 ‚Ä¢ ISO 27001 ‚Ä¢ PWA
            </div>
        </div>
    </div>
    
    <!-- Battery Indicator -->
    <div class="battery-indicator hidden" id="batteryIndicator">
        <i class="fas fa-battery-full"></i>
        <span id="batteryLevel">100%</span>
    </div>
    
    <!-- GPS Tracker -->
    <div class="gps-tracker hidden" id="gpsTracker">
        <i class="fas fa-map-marker-alt"></i>
        <span id="gpsStatus">GPS: Off</span>
    </div>
    
    <!-- Modals -->
    <div class="modal-backdrop" id="loginModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-key"></i>
                    <span data-i18n="modal.login.title">Dream OS Authentication</span>
                </h3>
                <button class="modal-close" onclick="hideLoginModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" data-i18n="modal.login.role">Pilih Level Akses:</label>
                    <select id="loginRole" class="form-control">
                        <option value="public" data-i18n="roles.public">Public Access</option>
                        <option value="security" data-i18n="roles.security">Security</option>
                        <option value="admin" data-i18n="roles.admin">Administrator</option>
                        <option value="architect" data-i18n="roles.architect">Mr. M Architect</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword" class="form-label" data-i18n="modal.login.password">Password:</label>
                    <input type="password" id="loginPassword" class="form-control" 
                           placeholder="Enter password" autocomplete="current-password">
                </div>
                
                <div class="flex gap-3">
                    <button class="btn btn-primary btn-block" onclick="processLogin()">
                        <i class="fas fa-sign-in-alt"></i>
                        <span data-i18n="modal.login.submit">Login</span>
                    </button>
                    <button class="btn btn-secondary" onclick="hideLoginModal()">
                        <i class="fas fa-times"></i>
                        <span data-i18n="modal.cancel">Cancel</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingMessage">Loading system...</div>
    </div>
    
    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>
    
    <!-- PWA Install Prompt -->
    <div id="installPrompt" class="hidden" style="position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: var(--iso-bg-secondary); padding: 1rem; border-radius: var(--radius-iso-lg); border: 2px solid var(--iso-primary); z-index: 9999; max-width: 90%;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div style="font-size: 2rem;">üì±</div>
            <div>
                <div style="font-weight: bold; margin-bottom: 0.25rem;">Install Dream OS</div>
                <div style="font-size: 0.875rem; color: var(--iso-text-tertiary); margin-bottom: 0.5rem;">Install app for better experience</div>
                <div style="display: flex; gap: 0.5rem;">
                    <button onclick="installPWA()" style="padding: 0.5rem 1rem; background: var(--iso-primary); color: white; border: none; border-radius: var(--radius-iso-md); cursor: pointer;">
                        Install
                    </button>
                    <button onclick="document.getElementById('installPrompt').classList.add('hidden')" style="padding: 0.5rem 1rem; background: transparent; border: 1px solid var(--iso-border-primary); color: var(--iso-text-secondary); border-radius: var(--radius-iso-md); cursor: pointer;">
                        Later
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- External Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        // ================= QUANTUM CONFIGURATION =================
        const QUANTUM_CONFIG = {
            VERSION: '4.2.0',
            SYSTEM_NAME: 'Dream OS Quantum',
            SCHOOL_NAME: 'SIF Al Fikri',
            DEVELOPER: 'Dream Team - The Power Soul of Shalawat',
            
            // Backend API
            API_BASE_URL: window.location.hostname === 'localhost' 
                ? 'http://localhost:3001/api'
                : 'https://api.dreamos.sif-alfikri.sch.id/api',
            
            // Supabase Configuration
            SUPABASE: {
                URL: 'https://ywtpykgjvbjwhmapmygb.supabase.co',
                ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl3dHB5a2dqdmJqd2htYXBteWdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDM2Njg2NzQsImV4cCI6MjAxOTI0NDY3NH0.18tXq9tJNqKJ0tQq8q8q8q8q8q8q8q8q8q8q8q8q8q8', // Anon key only
                TABLES: {
                    BOOKINGS: 'bookings',
                    K3_REPORTS: 'k3_reports',
                    SECURITY_REPORTS: 'security_reports'
                }
            },
            
            // Security Configuration
            SECURITY: {
                SESSION_TIMEOUT: 30,
                MAX_LOGIN_ATTEMPTS: 3,
                PASSWORD_MIN_LENGTH: 8,
                ENABLE_BIOMETRIC: true,
                ENABLE_2FA: false
            },
            
            // PWA Configuration
            PWA: {
                ENABLED: true,
                CACHE_VERSION: 'v4.2.0',
                OFFLINE_SUPPORT: true,
                BACKGROUND_SYNC: true,
                PUSH_NOTIFICATIONS: false
            },
            
            // Internationalization
            I18N: {
                DEFAULT_LANGUAGE: 'id',
                LANGUAGES: ['id', 'en', 'ar'],
                RTL_LANGUAGES: ['ar'],
                AUTO_DETECT: true
            },
            
            // Performance
            PERFORMANCE: {
                LAZY_LOADING: true,
                IMAGE_OPTIMIZATION: true,
                CACHE_STRATEGY: 'network-first',
                COMPRESSION: true
            },
            
            // Monitoring
            MONITORING: {
                ERROR_TRACKING: true,
                PERFORMANCE_METRICS: true,
                USAGE_ANALYTICS: true,
                AUDIT_LOGGING: true
            }
        };
        
        // ================= QUANTUM STATE MANAGEMENT =================
        const QuantumState = {
            // User State
            user: null,
            role: 'public',
            session: null,
            permissions: [],
            
            // System State
            language: 'id',
            direction: 'ltr',
            online: navigator.onLine,
            battery: null,
            location: null,
            
            // UI State
            currentForm: null,
            loading: false,
            notifications: [],
            
            // Data State
            bookings: [],
            k3Reports: [],
            securityReports: [],
            
            // Initialize
            init() {
                this.loadSession();
                this.detectLanguage();
                this.setupEventListeners();
                this.checkPWAInstall();
                this.startServices();
            },
            
            loadSession() {
                const session = localStorage.getItem('dreamos_session');
                if (session) {
                    try {
                        const data = JSON.parse(session);
                        if (data.expiry > Date.now()) {
                            this.user = data.user;
                            this.role = data.role;
                            this.session = data;
                            return true;
                        }
                    } catch (e) {
                        localStorage.removeItem('dreamos_session');
                    }
                }
                return false;
            },
            
            saveSession(user, role) {
                const session = {
                    user,
                    role,
                    loginTime: Date.now(),
                    expiry: Date.now() + (QUANTUM_CONFIG.SECURITY.SESSION_TIMEOUT * 60000),
                    device: navigator.userAgent
                };
                localStorage.setItem('dreamos_session', JSON.stringify(session));
                this.session = session;
                this.user = user;
                this.role = role;
            },
            
            clearSession() {
                localStorage.removeItem('dreamos_session');
                this.user = null;
                this.role = 'public';
                this.session = null;
            },
            
            detectLanguage() {
                const urlParams = new URLSearchParams(window.location.search);
                const urlLang = urlParams.get('lang');
                const storedLang = localStorage.getItem('dreamos_lang');
                const browserLang = navigator.language.split('-')[0];
                
                this.language = urlLang || storedLang || 
                    (QUANTUM_CONFIG.I18N.LANGUAGES.includes(browserLang) ? browserLang : QUANTUM_CONFIG.I18N.DEFAULT_LANGUAGE);
                
                this.direction = QUANTUM_CONFIG.I18N.RTL_LANGUAGES.includes(this.language) ? 'rtl' : 'ltr';
                
                document.documentElement.lang = this.language;
                document.documentElement.dir = this.direction;
                
                localStorage.setItem('dreamos_lang', this.language);
            },
            
            setLanguage(lang) {
                if (!QUANTUM_CONFIG.I18N.LANGUAGES.includes(lang)) return;
                
                this.language = lang;
                this.direction = QUANTUM_CONFIG.I18N.RTL_LANGUAGES.includes(lang) ? 'rtl' : 'ltr';
                
                document.documentElement.lang = lang;
                document.documentElement.dir = this.direction;
                
                localStorage.setItem('dreamos_lang', lang);
                
                // Update URL without reload
                const url = new URL(window.location);
                url.searchParams.set('lang', lang);
                window.history.replaceState({}, '', url);
                
                this.updateTranslations();
            },
            
            async updateTranslations() {
                try {
                    const response = await fetch(`/locales/${this.language}.json`);
                    const translations = await response.json();
                    
                    // Update all elements with data-i18n
                    document.querySelectorAll('[data-i18n]').forEach(el => {
                        const key = el.getAttribute('data-i18n');
                        if (translations[key]) {
                            if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                                el.placeholder = translations[key];
                            } else if (el.hasAttribute('title')) {
                                el.title = translations[key];
                            } else if (el.hasAttribute('alt')) {
                                el.alt = translations[key];
                            } else {
                                el.textContent = translations[key];
                            }
                        }
                    });
                } catch (error) {
                    console.warn('Failed to load translations:', error);
                }
            },
            
            setupEventListeners() {
                // Network status
                window.addEventListener('online', () => {
                    this.online = true;
                    this.showNotification('Koneksi internet kembali', 'success');
                    document.getElementById('connectionDot').className = 'connection-dot';
                    document.getElementById('connectionText').textContent = 'Online';
                });
                
                window.addEventListener('offline', () => {
                    this.online = false;
                    this.showNotification('Mode offline aktif', 'warning');
                    document.getElementById('connectionDot').className = 'connection-dot offline';
                    document.getElementById('connectionText').textContent = 'Offline';
                });
                
                // Battery status
                if ('getBattery' in navigator) {
                    navigator.getBattery().then(battery => {
                        this.battery = battery;
                        this.updateBatteryUI();
                        
                        battery.addEventListener('levelchange', () => this.updateBatteryUI());
                        battery.addEventListener('chargingchange', () => this.updateBatteryUI());
                    });
                }
                
                // Visibility change
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        // Save state when tab is hidden
                        this.saveState();
                    }
                });
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.altKey) {
                        switch(e.key) {
                            case 'b': showForm('booking'); break;
                            case 'k': showForm('k3'); break;
                            case 's': if (this.role !== 'public') showForm('security'); break;
                            case 'a': if (this.role === 'admin' || this.role === 'architect') showAdminPanel(); break;
                            case 'g': if (this.role === 'architect') showGhostTools(); break;
                            case 'l': showLoginModal(); break;
                            case 'Escape': hideAllForms(); break;
                        }
                    }
                });
            },
            
            updateBatteryUI() {
                if (!this.battery) return;
                
                const indicator = document.getElementById('batteryIndicator');
                const level = document.getElementById('batteryLevel');
                
                if (!indicator || !level) return;
                
                const percentage = Math.round(this.battery.level * 100);
                level.textContent = `${percentage}%`;
                
                indicator.classList.remove('hidden');
                
                // Update icon based on level
                let icon = 'fa-battery-full';
                if (percentage <= 20) icon = 'fa-battery-quarter';
                else if (percentage <= 50) icon = 'fa-battery-half';
                else if (percentage <= 80) icon = 'fa-battery-three-quarters';
                
                indicator.querySelector('i').className = `fas ${icon}`;
                
                // Apply battery saver mode if below 20%
                if (percentage <= 20 && !this.battery.charging) {
                    this.enableBatterySaver();
                } else {
                    this.disableBatterySaver();
                }
            },
            
            enableBatterySaver() {
                document.body.classList.add('battery-saver');
                // Reduce animations
                document.documentElement.style.setProperty('--animation-duration', '0.1s');
                // Lower image quality
                window.imageQuality = 0.5;
            },
            
            disableBatterySaver() {
                document.body.classList.remove('battery-saver');
                document.documentElement.style.setProperty('--animation-duration', '0.3s');
                window.imageQuality = 1.0;
            },
            
            checkPWAInstall() {
                let deferredPrompt;
                
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    
                    // Show install prompt after 5 seconds
                    setTimeout(() => {
                        const prompt = document.getElementById('installPrompt');
                        if (prompt && !localStorage.getItem('pwa_install_dismissed')) {
                            prompt.classList.remove('hidden');
                        }
                    }, 5000);
                });
                
                window.installPWA = async () => {
                    if (!deferredPrompt) return;
                    
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        this.showNotification('Dream OS installed successfully!', 'success');
                    }
                    
                    document.getElementById('installPrompt').classList.add('hidden');
                    localStorage.setItem('pwa_install_dismissed', 'true');
                };
            },
            
            startServices() {
                // Start time update
                setInterval(() => {
                    const now = new Date();
                    document.getElementById('currentTime').textContent = 
                        now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                }, 1000);
                
                // Start session timer if logged in
                if (this.session) {
                    this.startSessionTimer();
                }
                
                // Initialize service worker
                this.registerServiceWorker();
                
                // Update UI based on role
                this.updateUIForRole();
            },
            
            startSessionTimer() {
                if (!this.session) return;
                
                const updateTimer = () => {
                    if (!this.session) return;
                    
                    const elapsed = Date.now() - this.session.loginTime;
                    const remaining = this.session.expiry - Date.now();
                    
                    if (remaining <= 0) {
                        this.clearSession();
                        this.showNotification('Session expired', 'warning');
                        this.updateUIForRole();
                        return;
                    }
                    
                    const minutes = Math.floor(remaining / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    
                    document.getElementById('sessionTimer').textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                };
                
                updateTimer();
                setInterval(updateTimer, 1000);
            },
            
            async registerServiceWorker() {
                if ('serviceWorker' in navigator && QUANTUM_CONFIG.PWA.ENABLED) {
                    try {
                        const registration = await navigator.serviceWorker.register('/sw.js');
                        console.log('Service Worker registered:', registration);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    this.showNotification('New update available!', 'info');
                                }
                            });
                        });
                    } catch (error) {
                        console.error('Service Worker registration failed:', error);
                    }
                }
            },
            
            updateUIForRole() {
                const sections = {
                    public: document.getElementById('publicSection'),
                    security: document.getElementById('securitySection'),
                    admin: document.getElementById('adminSection'),
                    architect: document.getElementById('architectSection')
                };
                
                const loginBtn = document.getElementById('loginBtn');
                const userBadge = document.getElementById('userBadge');
                const currentModeText = document.getElementById('currentModeText');
                
                // Hide all sections first
                Object.values(sections).forEach(section => {
                    if (section) section.classList.add('hidden');
                });
                
                // Show public section always
                if (sections.public) sections.public.classList.remove('hidden');
                
                // Show role-specific sections
                if (this.role === 'security' || this.role === 'admin' || this.role === 'architect') {
                    if (sections.security) sections.security.classList.remove('hidden');
                }
                if (this.role === 'admin' || this.role === 'architect') {
                    if (sections.admin) sections.admin.classList.remove('hidden');
                }
                if (this.role === 'architect') {
                    if (sections.architect) sections.architect.classList.remove('hidden');
                }
                
                // Update auth UI
                if (this.role === 'public') {
                    if (loginBtn) loginBtn.classList.remove('hidden');
                    if (userBadge) userBadge.classList.add('hidden');
                    if (currentModeText) currentModeText.textContent = 'Public Mode';
                } else {
                    if (loginBtn) loginBtn.classList.add('hidden');
                    if (userBadge) {
                        userBadge.classList.remove('hidden');
                        document.getElementById('userRole').textContent = 
                            this.role.charAt(0).toUpperCase() + this.role.slice(1);
                    }
                    if (currentModeText) {
                        currentModeText.textContent = 
                            this.role.charAt(0).toUpperCase() + this.role.slice(1) + ' Mode';
                    }
                }
            },
            
            showNotification(message, type = 'info', duration = 5000) {
                const container = document.getElementById('notificationContainer');
                if (!container) return;
                
                const id = 'notif-' + Date.now();
                const notification = document.createElement('div');
                notification.id = id;
                notification.className = `notification notification-${type}`;
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="fas fa-${this.getNotificationIcon(type)}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${this.getNotificationTitle(type)}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close" onclick="document.getElementById('${id}').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                container.appendChild(notification);
                
                // Auto remove
                if (duration > 0) {
                    setTimeout(() => {
                        if (document.getElementById(id)) {
                            document.getElementById(id).remove();
                        }
                    }, duration);
                }
                
                return id;
            },
            
            getNotificationIcon(type) {
                const icons = {
                    success: 'check-circle',
                    error: 'times-circle',
                    warning: 'exclamation-triangle',
                    info: 'info-circle'
                };
                return icons[type] || 'info-circle';
            },
            
            getNotificationTitle(type) {
                const titles = {
                    success: 'Success',
                    error: 'Error',
                    warning: 'Warning',
                    info: 'Information'
                };
                return titles[type] || 'Notification';
            },
            
            showLoading(message = 'Loading...') {
                const overlay = document.getElementById('loadingOverlay');
                const messageEl = document.getElementById('loadingMessage');
                
                if (overlay && messageEl) {
                    messageEl.textContent = message;
                    overlay.classList.add('active');
                    this.loading = true;
                }
            },
            
            hideLoading() {
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) {
                    overlay.classList.remove('active');
                    this.loading = false;
                }
            },
            
            saveState() {
                const state = {
                    user: this.user,
                    role: this.role,
                    language: this.language,
                    timestamp: Date.now()
                };
                localStorage.setItem('dreamos_state', JSON.stringify(state));
            },
            
            loadState() {
                try {
                    const state = JSON.parse(localStorage.getItem('dreamos_state'));
                    if (state && Date.now() - state.timestamp < 3600000) { // 1 hour
                        this.user = state.user;
                        this.role = state.role;
                        this.setLanguage(state.language);
                        return true;
                    }
                } catch (e) {
                    // Ignore error
                }
                return false;
            }
        };
        
        // ================= APPLICATION FUNCTIONS =================
        function showForm(formId) {
            hideAllForms();
            const form = document.getElementById(formId + 'Form');
            if (form) {
                form.classList.add('active');
                QuantumState.currentForm = formId;
                
                // Scroll to form
                setTimeout(() => {
                    form.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
        }
        
        function hideAllForms() {
            document.querySelectorAll('.form-container').forEach(form => {
                form.classList.remove('active');
            });
            QuantumState.currentForm = null;
        }
        
        function goBack() {
            if (QuantumState.currentForm) {
                hideAllForms();
                QuantumState.showNotification('Kembali ke dashboard', 'info');
            } else {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }
        
        function hideLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }
        
        async function processLogin() {
            const role = document.getElementById('loginRole').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!password) {
                QuantumState.showNotification('Password required', 'error');
                return;
            }
            
            QuantumState.showLoading('Authenticating...');
            
            try {
                // In production, this would call your backend API
                // For demo, using simple validation
                const validPasswords = {
                    security: '@sec_Sif-Af2026',
                    admin: '@dm1n_Sec2026',
                    architect: '418626'
                };
                
                if (role === 'public' || (validPasswords[role] && password === validPasswords[role])) {
                    QuantumState.saveSession(`User_${role}`, role);
                    QuantumState.updateUIForRole();
                    hideLoginModal();
                    QuantumState.showNotification(`Login berhasil sebagai ${role}`, 'success');
                } else {
                    QuantumState.showNotification('Invalid credentials', 'error');
                }
            } catch (error) {
                QuantumState.showNotification('Login failed', 'error');
                console.error('Login error:', error);
            } finally {
                QuantumState.hideLoading();
            }
        }
        
        function logout() {
            QuantumState.clearSession();
            QuantumState.updateUIForRole();
            hideAllForms();
            QuantumState.showNotification('Logout berhasil', 'info');
        }
        
        function showAdminPanel() {
            QuantumState.showNotification('Admin Panel - Coming Soon', 'info');
        }
        
        function showGhostTools() {
            QuantumState.showNotification('Ghost Tools - Developer Mode Active', 'info');
        }
        
        // ================= INITIALIZATION =================
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Dream OS Quantum v4.2 Initializing...');
            
            // Initialize Quantum State
            QuantumState.init();
            
            // Setup language switcher
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const lang = btn.dataset.lang;
                    QuantumState.setLanguage(lang);
                    
                    // Update active button
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });
            
            // Setup card click events
            document.getElementById('bookingCard')?.addEventListener('click', () => showForm('booking'));
            document.getElementById('k3Card')?.addEventListener('click', () => showForm('k3'));
            document.getElementById('securityCard')?.addEventListener('click', () => showForm('security'));
            document.getElementById('adminCard')?.addEventListener('click', showAdminPanel);
            document.getElementById('ghostCard')?.addEventListener('click', showGhostTools);
            
            // Setup login button
            document.getElementById('loginBtn')?.addEventListener('click', showLoginModal);
            document.getElementById('logoutBtn')?.addEventListener('click', logout);
            
            // Setup logo click (ghost mode trigger)
            let ghostClicks = 0;
            let lastClick = 0;
            document.getElementById('logoSection')?.addEventListener('click', () => {
                const now = Date.now();
                if (now - lastClick < 1000) {
                    ghostClicks++;
                } else {
                    ghostClicks = 1;
                }
                lastClick = now;
                
                if (ghostClicks === 5) {
                    ghostClicks = 0;
                    showLoginModal();
                    document.getElementById('loginRole').value = 'architect';
                    QuantumState.showNotification('üëª Ghost Mode activated!', 'info');
                }
            });
            
            // Setup form submissions
            document.getElementById('bookingFormElement')?.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = {
                    sarana: document.getElementById('sarana').value,
                    tanggal: new Date().toISOString().split('T')[0],
                    waktu_mulai: '08:00',
                    waktu_selesai: '10:00',
                    nama: 'Test User',
                    kelas: 'Test Class',
                    whatsapp: '08123456789',
                    jumlah_peserta: 10,
                    tujuan: 'Test Purpose',
                    keterangan: 'Test'
                };
                
                QuantumState.showLoading('Mengirim booking...');
                
                try {
                    // Send to backend API
                    const response = await fetch(`${QUANTUM_CONFIG.API_BASE_URL}/bookings`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    if (response.ok) {
                        QuantumState.showNotification('Booking berhasil dikirim!', 'success');
                        hideAllForms();
                        document.getElementById('bookingFormElement').reset();
                    } else {
                        throw new Error('Failed to submit booking');
                    }
                } catch (error) {
                    QuantumState.showNotification('Gagal mengirim booking', 'error');
                    console.error('Booking error:', error);
                } finally {
                    QuantumState.hideLoading();
                }
            });
            
            // Check if app is running as PWA
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('üì± Running as PWA');
                document.body.classList.add('pwa-mode');
            }
            
            // Initialize GPS if permission granted
            if ('geolocation' in navigator) {
                const gpsTracker = document.getElementById('gpsTracker');
                if (gpsTracker) {
                    gpsTracker.classList.remove('hidden');
                    
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            QuantumState.location = position;
                            gpsTracker.querySelector('#gpsStatus').textContent = 'GPS: Active';
                            gpsTracker.classList.add('gps-active');
                        },
                        () => {
                            gpsTracker.querySelector('#gpsStatus').textContent = 'GPS: Off';
                        }
                    );
                }
            }
            
            // Show welcome message
            setTimeout(() => {
                QuantumState.showNotification(
                    'Dream OS Quantum v4.2 - ISO 27001 Certified System Ready',
                    'success',
                    3000
                );
                console.log('‚úÖ System initialized successfully');
            }, 1000);
        });
        
        // ================= PWA INSTALLATION =================
        window.addEventListener('appinstalled', () => {
            localStorage.setItem('pwa_installed', 'true');
            QuantumState.showNotification('Dream OS installed successfully!', 'success');
        });
        
        // ================= OFFLINE DETECTION =================
        window.addEventListener('offline', () => {
            QuantumState.showNotification(
                'Anda sedang offline. Data akan disinkronkan saat online.',
                'warning',
                5000
            );
        });
        
        // ================= ERROR HANDLING =================
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            
            // Don't show technical errors to users
            if (!event.error.message.includes('Failed to fetch')) {
                QuantumState.showNotification(
                    'Terjadi kesalahan sistem. Data disimpan secara lokal.',
                    'error'
                );
            }
            
            // Log error to server if online
            if (QuantumState.online) {
                fetch(`${QUANTUM_CONFIG.API_BASE_URL}/errors`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        error: event.error.message,
                        stack: event.error.stack,
                        url: window.location.href,
                        timestamp: new Date().toISOString()
                    })
                }).catch(() => {
                    // Silently fail
                });
            }
        });
        
        // ================= SERVICE WORKER =================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(
                    (registration) => {
                        console.log('ServiceWorker registration successful:', registration);
                    },
                    (error) => {
                        console.log('ServiceWorker registration failed:', error);
                    }
                );
            });
        }
        
        // ================= EXPORT FOR DEBUGGING =================
        window.DreamOS = {
            config: QUANTUM_CONFIG,
            state: QuantumState,
            utils: {
                showForm,
                hideAllForms,
                showLoginModal,
                logout,
                showNotification: QuantumState.showNotification.bind(QuantumState)
            }
        };
        
        console.log('üåê Dream OS Quantum v4.2 Loaded');
        console.log('üìä System:', QUANTUM_CONFIG.SYSTEM_NAME);
        console.log('üè´ School:', QUANTUM_CONFIG.SCHOOL_NAME);
        console.log('üë• Team:', QUANTUM_CONFIG.DEVELOPER);
        console.log('üîê Security: ISO 27001 Compliant');
        console.log('üì± PWA: Enabled');
    </script>
</body>
</html>
