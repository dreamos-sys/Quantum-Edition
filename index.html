<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0e17">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- FAVICON -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <!-- FONTAWESOME -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <title>üöÄ DREAM OS v13.0 | Sayyidina Muhammad Edition</title>
    
    <style>
        /* ========== CSS VARIABLES ========== */
        :root {
            --bg-dark: #0a0e17;
            --bg-card: #151a2d;
            --gold-primary: #fbbf24;
            --gold-secondary: #d97706;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --purple: #8b5cf6;
            --text-light: #f1f5f9;
            --text-dim: #94a3b8;
            --border-radius: 16px;
            --grid-gap: 12px;
            --touch-target: 60px;
            --font-base: 14px;
        }
        
        /* ========== RESET & BASE ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }
        
        body {
            background: #000000; /* Deep Black for AMOLED */
            color: var(--text-light);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            font-size: var(--font-base);
            line-height: 1.5;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* ========== LOGIN GATE ========== */
        #loginGate {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1f38 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.5s;
        }
        
        .gate-modal {
            background: rgba(21, 26, 45, 0.95);
            border: 2px solid var(--gold-primary);
            border-radius: 24px;
            padding: 2.5rem;
            width: 90%;
            max-width: 400px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.5s;
            will-change: transform, opacity;
        }
        
        .shalawat-header {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(251, 191, 36, 0.3);
        }
        
        .arabic {
            font-size: 1.2rem;
            color: var(--gold-primary);
            font-weight: 700;
            margin-bottom: 0.5rem;
            direction: rtl;
        }
        
        .translation {
            color: var(--text-dim);
            font-size: 0.9rem;
        }
        
        .gate-title h1 {
            color: var(--gold-primary);
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        
        .gate-title p {
            color: var(--text-dim);
            margin-bottom: 2rem;
        }
        
        .gate-input {
            margin: 2rem 0;
        }
        
        .gate-input input {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--gold-primary);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            text-align: center;
            letter-spacing: 2px;
            font-weight: 700;
        }
        
        .gate-input input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.3);
        }
        
        .gate-hint {
            color: var(--text-dim);
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }
        
        .gate-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 1.5rem 0;
        }
        
        .gate-btn {
            padding: 10px 6px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            will-change: transform, opacity;
        }
        
        .gate-btn.user { background: var(--info); color: white; }
        .gate-btn.admin { background: var(--gold-primary); color: black; }
        .gate-btn.security { background: var(--warning); color: black; }
        .gate-btn.hrd { background: var(--purple); color: white; }
        
        .gate-btn:active {
            transform: scale(0.95);
        }
        
        .gate-submit {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
            border: none;
            border-radius: 12px;
            color: black;
            font-weight: 800;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 1.5rem;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .gate-submit:active {
            transform: scale(0.98);
        }
        
        .gate-footer {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .iso-badge {
            display: inline-block;
            background: var(--gold-primary);
            color: black;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }
        
        .device-tag {
            color: var(--text-dim);
            font-size: 0.7rem;
            margin-top: 1rem;
        }
        
        /* ========== MAIN APP ========== */
        #mainApp {
            display: none;
        }
        
        /* DYNAMIC HEADER */
        .dynamic-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(10, 14, 23, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--gold-primary);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-left, .header-right {
            display: flex;
            gap: 10px;
        }
        
        .sos-btn, .saw-btn, .voice-btn, .quantum-btn {
            background: none;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sos-btn { color: var(--danger); }
        .saw-btn { color: var(--gold-primary); }
        .voice-btn { color: var(--info); }
        .quantum-btn { color: var(--purple); }
        
        .sos-btn:active, .saw-btn:active, .voice-btn:active, .quantum-btn:active {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(0.95);
        }
        
        .header-center {
            text-align: center;
            flex: 1;
        }
        
        #dynamicTitle {
            color: var(--gold-primary);
            font-weight: 800;
            font-size: 1.1rem;
            display: block;
            margin-bottom: 4px;
        }
        
        .status-indicators {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .status-badge {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .status-badge.online { color: var(--success); }
        .status-badge.role { color: var(--gold-primary); }
        .status-badge.device { color: var(--purple); font-size: 0.65rem; }
        
        /* GHOST MENU */
        #ghostMenu {
            display: none;
            margin: 20px 1rem;
            padding: 15px;
            border: 2px dashed var(--gold-primary);
            border-radius: 15px;
            background: rgba(251, 191, 36, 0.05);
            animation: pulse 2s infinite;
        }
        
        .ghost-header {
            color: var(--gold-primary);
            font-weight: 800;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .family-hub {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .family-btn {
            padding: 10px;
            background: var(--bg-card);
            border-radius: 12px;
            font-size: 0.8rem;
            cursor: pointer;
            border: 1px solid #333;
            text-align: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .family-btn:active {
            transform: scale(0.95);
            border-color: var(--gold-primary);
        }
        
        /* BENTO GRID */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--grid-gap);
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .tile {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            will-change: transform, opacity;
        }
        
        .tile:hover, .tile:active {
            border-color: var(--gold-primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(251, 191, 36, 0.15);
        }
        
        .tile-large {
            grid-column: span 2;
        }
        
        .tile-icon {
            font-size: 2.5rem;
            color: var(--gold-primary);
            margin-bottom: 1rem;
        }
        
        .tile-title {
            font-weight: 800;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        
        .tile-subtitle {
            color: var(--text-dim);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        /* BOTTOM DOCK WITH FLOATING SCANNER */
        .bottom-dock {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(21, 26, 45, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            border-top: 2px solid var(--gold-primary);
            z-index: 1000;
        }
        
        .dock-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 0.8rem;
            padding: 8px 12px;
            min-width: 60px;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .dock-btn.active {
            color: var(--gold-primary);
            background: rgba(251, 191, 36, 0.1);
        }
        
        .dock-btn:active {
            transform: scale(0.95);
        }
        
        .dock-btn i {
            font-size: 1.3rem;
            margin-bottom: 4px;
        }
        
        /* FLOATING SCANNER BUTTON */
        .floating-scanner {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.3);
            z-index: 999;
            animation: pulse-glow 2s infinite;
            border: 3px solid white;
            transition: all 0.2s;
        }
        
        .floating-scanner:active {
            transform: scale(0.9);
            box-shadow: 0 5px 15px rgba(251, 191, 36, 0.5);
        }
        
        .floating-scanner i {
            font-size: 1.8rem;
            color: black;
        }
        
        /* MODULE CONTENT */
        .module-container {
            padding: 1rem;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }
        
        /* FORM STYLES */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--gold-primary);
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(251, 191, 36, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        /* STATUS BADGES */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
        }
        
        .badge-success { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .badge-warning { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .badge-danger { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .badge-info { background: rgba(59, 130, 246, 0.2); color: var(--info); }
        
        /* BUTTONS */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
            color: black;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        /* SPIRITUAL FOOTER */
        .spiritual-footer {
            padding: 1rem;
            background: rgba(10, 14, 23, 0.8);
            border-top: 1px solid rgba(251, 191, 36, 0.1);
            margin-top: 2rem;
        }
        
        .shalawat-ticker {
            color: var(--gold-primary);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            overflow: hidden;
            direction: rtl;
            text-align: center;
        }
        
        .system-signature {
            color: var(--text-dim);
            font-size: 0.7rem;
            text-align: center;
        }
        
        /* AUTO-LOCK OVERLAY */
        #autoLockOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 23, 0.95);
            z-index: 9998;
            display: none;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .lock-content {
            background: var(--bg-card);
            border: 3px solid var(--danger);
            border-radius: 20px;
            padding: 2rem;
            max-width: 90%;
        }
        
        /* SECURITY A4 REPORT STYLE */
        .a4-report {
            background: white;
            color: black;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            font-family: 'Times New Roman', Times, serif;
        }
        
        .report-header {
            text-align: center;
            border-bottom: 2px solid black;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .report-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .report-subtitle {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 10px 30px rgba(251, 191, 36, 0.3); }
            50% { box-shadow: 0 10px 30px rgba(251, 191, 36, 0.6); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .gate-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .bento-grid {
                grid-template-columns: 1fr;
            }
            
            .tile-large {
                grid-column: span 1;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ========== LOGIN GATE ========== -->
    <div id="loginGate" class="gate-container">
        <div class="gate-modal">
            <div class="shalawat-header">
                <div class="arabic">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸíŸÖŸê</div>
                <div class="translation">Dengan nama Allah Yang Maha Pengasih Lagi Maha Penyayang</div>
            </div>
            
            <div class="gate-title">
                <h1>üöÄ DREAM OS v13.0</h1>
                <p>Sayyidina Muhammad Edition</p>
            </div>
            
            <div class="gate-input">
                <input type="password" id="gatePassword" 
                       placeholder="Enter Access Password" 
                       autocomplete="off"
                       onkeypress="if(event.key==='Enter')gateLogin()">
                <div class="gate-hint">Press Enter or tap Access Button</div>
            </div>
            
            <div class="gate-buttons">
                <button class="gate-btn user" onclick="fillPassword('user_@1234')">
                    <i class="fas fa-user"></i> USER
                </button>
                <button class="gate-btn admin" onclick="fillPassword('4dm1n_AF6969@00')">
                    <i class="fas fa-crown"></i> ADMIN
                </button>
                <button class="gate-btn security" onclick="fillPassword('sec_AF2025')">
                    <i class="fas fa-shield-alt"></i> SECURITY
                </button>
                <button class="gate-btn hrd" onclick="fillPassword('hrd_AF2025_sec')">
                    <i class="fas fa-users"></i> HRD
                </button>
            </div>
            
            <button class="gate-submit" onclick="gateLogin()">
                <i class="fas fa-key"></i> ACCESS QUANTUM SYSTEM
            </button>
            
            <div class="gate-footer">
                <div class="iso-badge">ISO GOLD COMPLIANT</div>
                <div class="device-tag" id="deviceTag">
                    <i class="fas fa-fingerprint"></i> Device ID: <span id="deviceId">Scanning...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== AUTO-LOCK OVERLAY ========== -->
    <div id="autoLockOverlay">
        <div class="lock-content">
            <div style="font-size: 4rem; color: var(--danger); margin-bottom: 1rem;">üîí</div>
            <h2 style="color: var(--danger); margin-bottom: 1rem;">SESI TERKUNCI</h2>
            <p style="margin-bottom: 1.5rem;">Tidak ada aktivitas selama 5 menit</p>
            <button onclick="unlockSession()" style="background: var(--danger); color: white; border: none; padding: 12px 30px; border-radius: 10px; font-weight: 800; cursor: pointer;">
                <i class="fas fa-lock-open"></i> UNLOCK SESSION
            </button>
            <p style="margin-top: 1.5rem; font-size: 0.8rem; color: var(--text-dim);">
                Untuk keamanan data sensitif
            </p>
        </div>
    </div>

    <!-- ========== MAIN APPLICATION ========== -->
    <div id="mainApp">
        <!-- DYNAMIC HEADER -->
        <header class="dynamic-header">
            <div class="header-left">
                <button class="sos-btn" onclick="triggerSOS()" title="Emergency SOS">
                    <i class="fas fa-sos"></i>
                </button>
                <button class="saw-btn" onclick="sendShalawat()" title="Send Shalawat">
                    <i class="fas fa-pray"></i>
                </button>
            </div>
            
            <div class="header-center">
                <span id="dynamicTitle">DREAM OS v13.0</span>
                <div class="status-indicators">
                    <span id="weatherStatus" class="status-badge">
                        <i class="fas fa-thermometer-half"></i> <span id="weatherTemp">28¬∞C</span>
                    </span>
                    <span id="syncStatus" class="status-badge online">
                        <i class="fas fa-sync"></i> Online
                    </span>
                    <span id="userRoleBadge" class="status-badge role">
                        <i class="fas fa-user"></i> GUEST
                    </span>
                    <span id="deviceStatus" class="status-badge device" style="display: none;">
                        <i class="fas fa-check-circle"></i> Trusted
                    </span>
                </div>
            </div>
            
            <div class="header-right">
                <button class="voice-btn" onclick="startVoiceCommand()" title="Voice Command (Ctrl+Space)">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="quantum-btn" onclick="showQuantumDashboard()" title="Quantum Bridge">
                    <i class="fas fa-satellite"></i>
                </button>
            </div>
        </header>

        <!-- GHOST MENU (Only visible for Architect) -->
        <div id="ghostMenu">
            <div class="ghost-header">
                <i class="fas fa-ghost"></i>
                <span>ARCHITECT FAMILY HUB</span>
            </div>
            <div id="fingerprintDisplay" style="font-size: 0.7rem; color: var(--success); margin: 5px 0;">
                <i class="fas fa-fingerprint"></i> Device Verified: REDMI_NOTE_9_PRO_MATCHED
            </div>
            <div class="family-hub">
                <div class="family-btn" onclick="window.open('https://gemini.google.com')">
                    <i class="fas fa-sparkles" style="color:#4285f4"></i><br>
                    <span>SIS GEMINI</span>
                </div>
                <div class="family-btn" onclick="window.open('https://chat.deepseek.com')">
                    <i class="fas fa-brain" style="color:#10b981"></i><br>
                    <span>BRO DSEEK</span>
                </div>
                <div class="family-btn" onclick="window.open('https://openai.com')">
                    <i class="fas fa-microchip" style="color:white"></i><br>
                    <span>BRO o1</span>
                </div>
            </div>
        </div>

        <!-- BENTO GRID DASHBOARD -->
        <div class="bento-grid">
            <div class="tile tile-large" onclick="openModule('inventory')">
                <div class="tile-icon">
                    <i class="fas fa-warehouse"></i>
                </div>
                <div class="tile-title">Gudang & Inventaris</div>
                <div class="tile-subtitle">Tap-Tap System ‚Ä¢ QR ‚Ä¢ Real-time Sync</div>
            </div>
            
            <div class="tile" onclick="openModule('hrd')">
                <div class="tile-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="tile-title">Administrasi HRD</div>
                <div class="tile-subtitle">Staff Management</div>
            </div>

            <div class="tile" onclick="openModule('booking')">
                <div class="tile-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="tile-title">Booking Sarana</div>
                <div class="tile-subtitle">22 Unit Facilities</div>
            </div>
            
            <div class="tile" onclick="openModule('k3')">
                <div class="tile-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="tile-title">K3 & Security</div>
                <div class="tile-subtitle">Reports + Camera</div>
            </div>
            
            <div class="tile" onclick="openModule('quantum')">
                <div class="tile-icon">
                    <i class="fas fa-satellite-dish"></i>
                </div>
                <div class="tile-title">Quantum Bridge</div>
                <div class="tile-subtitle">Sync Status</div>
            </div>
        </div>

        <!-- MODULE CONTENT AREA -->
        <div id="moduleContent" class="module-container">
            <!-- Module content loaded dynamically here -->
            <div style="text-align: center; padding: 3rem; color: var(--text-dim);">
                <i class="fas fa-home" style="font-size: 3rem; margin-bottom: 1rem; color: var(--gold-primary);"></i>
                <h3 style="margin-bottom: 1rem; color: var(--gold-primary);" id="smartGreeting">Welcome to DREAM OS v13.0</h3>
                <p id="greetingSubtitle">Select a module from the dashboard to begin</p>
            </div>
        </div>

        <!-- FLOATING SCANNER BUTTON -->
        <div class="floating-scanner" onclick="openScanner()">
            <i class="fas fa-qrcode"></i>
        </div>

        <!-- BOTTOM DOCK (Thumb-Friendly) -->
        <nav class="bottom-dock">
            <button class="dock-btn active" onclick="showDashboard()">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </button>
            <button class="dock-btn" onclick="openModule('inventory')">
                <i class="fas fa-boxes"></i>
                <span>Inventory</span>
            </button>
            <button class="dock-btn" onclick="openModule('reports')">
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
            </button>
            <button class="dock-btn" onclick="openModule('security')">
                <i class="fas fa-user-shield"></i>
                <span>Security</span>
            </button>
            <button class="dock-btn" onclick="showSettings()">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
        </nav>

        <!-- SPIRITUAL FOOTER -->
        <footer class="spiritual-footer">
            <div class="shalawat-ticker">
                <span class="arabic" id="shalawatText">ÿßŸéŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸéŸâ ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç ŸàŸéÿπŸéŸÑŸéŸâ ÿ¢ŸÑŸê ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç</span>
                <span class="separator"> ‚Ä¢ </span>
                <span class="translation" id="shalawatTranslation">Ya Allah, limpahkan shalawat kepada junjungan kami Nabi Muhammad</span>
            </div>
            <div class="system-signature">
                <small>DREAM OS v13.0 ISO Gold ‚Ä¢ The Power Soul of Shalawat ‚Ä¢ 
                <span id="connectionStatus">üü¢ Online</span> ‚Ä¢ 
                <span id="autoLockTimer">Auto-lock: 5:00</span></small>
                <br>
                <small id="auditTimestamp"></small>
            </div>
        </footer>
    </div>

    <script>
        // =====================================================
        // DREAM OS v13.0 ISO GOLD - CORE ENGINE
        // =====================================================
        
        console.log('üöÄ DREAM OS v13.0 ISO Gold Initializing...');
        console.log('ü§≤ The Power Soul of Shalawat Edition');
        
        // ========== ABSOLUTE CONFIG (NO TYPO) ==========
        const CONFIG = {
            passwords: {
                USER: "user_@1234",
                SECURITY: "sec_AF2025",
                ADMIN: "4dm1n_AF6969@00", // INI YANG BENER!
                HRD_ACCESS: "hrd_AF2025_sec",
                VAULT_INV: "4dm1in_6969@01",
                VAULT_WH: "4dm1n_9696@02",
                MASTER: "Mr.M_Architect_2025",
                GHOST: "418626"
            },
            
            // Jam Kerja: 07:30 - 16:00 (8.5 jam)
            workingHours: {
                start: 7.5, // 07:30
                end: 16,    // 16:00
                duration: 8.5 // jam
            },
            
            // 22 Unit Sarana Al-Fikri
            facilities: [
                "Aula SMP", "Aula SMA", "Aula Serbaguna", "Masjid Al-Fikri",
                "Lab Komputer 01", "Lab Komputer 02", "Perpustakaan", "Studio Musik",
                "Bus Sekolah 01", "Bus Sekolah 02", "Bus Sekolah 03", "Mobil Operasional",
                "Saung Besar", "Saung Kecil", "Lapangan Basket", "Lapangan Futsal",
                "Ruang Meeting Utama", "Ruang Tamu VIP", "Proyektor Utama", "Sound System Portable",
                "Kamera Dokumentasi", "Tenda Event"
            ],
            
            // 12 Unit Alat
            equipment: [
                "Sound Portable", "Proyektor Portable", "Kamera DSLR", "Tripod Kamera",
                "Mixer Audio", "Mic Wireless", "Speaker Portable", "LED Projector Screen",
                "Laptop Presentasi", "Kabel Extention 30m", "Kabel Rol AC", "Generator Portable"
            ],
            
            // Divisi
            divisions: ["SD", "SMP", "SMA", "UMUM", "YAYASAN", "KEAMANAN", "KEBERSIHAN", "LAINNYA"],
            
            // Shift Security (12 jam)
            securityShifts: [
                { id: 1, name: "Shift 1 (Siang)", time: "07:00 - 19:00" },
                { id: 2, name: "Shift 2 (Malam)", time: "19:00 - 07:00" }
            ]
        };

        // ========== DEVICE FINGERPRINTING SYSTEM ==========
        const DeviceSecurity = {
            getFingerprint: function() {
                const navigator_info = window.navigator;
                const screen_info = window.screen;
                let uid = navigator_info.mimeTypes.length;
                uid += navigator_info.userAgent.replace(/\D+/g, '');
                uid += navigator_info.plugins.length;
                uid += screen_info.height || '';
                uid += screen_info.width || '';
                uid += screen_info.pixelDepth || '';
                return "DEV-" + btoa(uid).substring(0, 12).toUpperCase();
            },

            verifyDevice: function() {
                const currentFingerprint = this.getFingerprint();
                const savedFingerprint = localStorage.getItem('DREAMOS_AUTHORIZED_DEVICE');

                if (!savedFingerprint) {
                    // Pendaftaran Device Pertama Kali
                    localStorage.setItem('DREAMOS_AUTHORIZED_DEVICE', currentFingerprint);
                    return { status: 'NEW_DEVICE', id: currentFingerprint };
                }

                if (currentFingerprint !== savedFingerprint) {
                    return { status: 'UNRECOGNIZED', id: currentFingerprint };
                }

                return { status: 'MATCHED', id: currentFingerprint };
            }
        };

        // ========== GLOBAL STATE ==========
        const STATE = {
            currentUser: null,
            userRole: null,
            isOnline: navigator.onLine,
            currentModule: null,
            shalawatCount: 0,
            inactivityTimer: null,
            lockTimeout: 5 * 60 * 1000, // 5 menit dalam milidetik
            lockWarningTime: 30 * 1000, // 30 detik sebelum lock
            weatherData: { temp: 28, condition: "Sunny" },
            dailyGreeting: "",
            bookingData: JSON.parse(localStorage.getItem('DREAMOS_BOOKINGS')) || [],
            k3Data: JSON.parse(localStorage.getItem('DREAMOS_K3')) || [],
            securityData: JSON.parse(localStorage.getItem('DREAMOS_SECURITY')) || []
        };

        // ========== SMART GREETING SYSTEM ==========
        function updateSmartGreeting() {
            const now = new Date();
            const day = now.getDay();
            const hour = now.getHours();
            const days = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
            const dayName = days[day];
            
            let greeting = "";
            let subtitle = "";
            
            // Check for special days
            if (day === 0) { // Minggu
                greeting = "Hari Minggu Libur!";
                subtitle = "Sistem dalam mode istirahat, kecuali Security";
            } else if (day === 5) { // Jumat
                greeting = "Jumat Berkah! üåô";
                subtitle = "Ingat: Sistem lock jam 10:30-13:00 untuk shalat Jumat";
            } else if (day === 6) { // Sabtu
                greeting = "Sabtu System Cancel";
                subtitle = "Booking harus konfirmasi manual ke Pak Erwin via WA";
            } else {
                // Normal days
                if (hour >= 5 && hour < 12) {
                    greeting = `Bismillah, ${dayName} Spirit!`;
                    subtitle = "Awali dengan Shalawat, selesaikan dengan hebat";
                } else if (hour >= 12 && hour < 15) {
                    greeting = `Selamat Siang!`;
                    subtitle = "Tetap semangat menyelesaikan tugas";
                } else if (hour >= 15 && hour < 18) {
                    greeting = `Selamat Sore!`;
                    subtitle = "Waktunya persiapan penutupan";
                } else {
                    greeting = `Selamat Malam!`;
                    subtitle = "Hanya Security yang aktif 24 jam";
                }
            }
            
            // Weather check
            if (STATE.weatherData.condition.toLowerCase().includes("hujan")) {
                subtitle += " ‚õàÔ∏è Waspada: Al-Fikri Hujan, cek titik genangan!";
            }
            
            STATE.dailyGreeting = greeting;
            
            // Update UI
            const greetingEl = document.getElementById('smartGreeting');
            const subtitleEl = document.getElementById('greetingSubtitle');
            if (greetingEl) greetingEl.textContent = greeting;
            if (subtitleEl) subtitleEl.textContent = subtitle;
        }

        // ========== WEATHER SYSTEM ==========
        async function fetchWeather() {
            try {
                // Simulate weather fetch (in real app, use API)
                const conditions = ["Sunny", "Cloudy", "Rainy", "Stormy"];
                const randomCondition = conditions[Math.floor(Math.random() * conditions.length)];
                
                STATE.weatherData = {
                    temp: Math.floor(Math.random() * 10) + 25, // 25-35¬∞C
                    condition: randomCondition
                };
                
                // Update UI
                document.getElementById('weatherTemp').textContent = `${STATE.weatherData.temp}¬∞C`;
                document.getElementById('weatherStatus').innerHTML = 
                    `<i class="fas fa-${getWeatherIcon(randomCondition)}"></i> ${STATE.weatherData.temp}¬∞C`;
                    
                // Update greeting if raining
                if (randomCondition === "Rainy" || randomCondition === "Stormy") {
                    updateSmartGreeting();
                }
            } catch (error) {
                console.log("Weather fetch failed:", error);
            }
        }
        
        function getWeatherIcon(condition) {
            const icons = {
                "Sunny": "sun",
                "Cloudy": "cloud",
                "Rainy": "cloud-rain",
                "Stormy": "bolt"
            };
            return icons[condition] || "thermometer-half";
        }

        // ========== AUTO-LOCK SYSTEM ==========
        function startInactivityTimer() {
            // Clear existing timer
            clearTimeout(STATE.inactivityTimer);
            
            // Set new timer
            STATE.inactivityTimer = setTimeout(() => {
                showAutoLock();
            }, STATE.lockTimeout);
            
            // Update UI timer
            updateLockTimer();
        }

        function resetInactivityTimer() {
            startInactivityTimer();
        }

        function showAutoLock() {
            document.getElementById('autoLockOverlay').style.display = 'flex';
            document.getElementById('mainApp').style.opacity = '0.3';
            document.getElementById('mainApp').style.pointerEvents = 'none';
            
            // Haptic feedback if available
            if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
        }

        function unlockSession() {
            document.getElementById('autoLockOverlay').style.display = 'none';
            document.getElementById('mainApp').style.opacity = '1';
            document.getElementById('mainApp').style.pointerEvents = 'auto';
            
            // Show spiritual message
            showSpiritualToast('Session unlocked. Bismillah.');
            
            // Restart timer
            resetInactivityTimer();
        }

        function updateLockTimer() {
            const timerElement = document.getElementById('autoLockTimer');
            if (!timerElement) return;
            
            let minutes = Math.floor(STATE.lockTimeout / (60 * 1000));
            let seconds = Math.floor((STATE.lockTimeout % (60 * 1000)) / 1000);
            
            const update = () => {
                if (seconds === 0) {
                    if (minutes === 0) {
                        timerElement.textContent = 'Auto-lock: 0:00';
                        return;
                    }
                    minutes--;
                    seconds = 59;
                } else {
                    seconds--;
                }
                
                timerElement.textContent = `Auto-lock: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                setTimeout(update, 1000);
            };
            
            update();
        }

        // ========== UI UTILITIES ==========
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'error' ? 'var(--danger)' : 
                            type === 'success' ? 'var(--success)' : 
                            type === 'warning' ? 'var(--warning)' : 'var(--info)'};
                color: white;
                padding: 12px 20px;
                border-radius: 10px;
                font-weight: 700;
                z-index: 1000;
                animation: slideUp 0.3s;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function showSpiritualToast(message = 'Bismillah, Data Tersimpan') {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
                color: black;
                padding: 15px 25px;
                border-radius: 12px;
                font-weight: 800;
                z-index: 1000;
                animation: slideUp 0.3s;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                text-align: center;
                direction: rtl;
            `;
            toast.innerHTML = `
                <div style="font-size: 1.1rem; margin-bottom: 5px;">${message}</div>
                <div style="font-size: 0.9rem; font-weight: 700;">ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸéŸâ ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç</div>
            `;
            document.body.appendChild(toast);
            
            // Haptic feedback
            if (navigator.vibrate) navigator.vibrate(50);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // ========== LOGIN FUNCTIONS ==========
        function fillPassword(password) {
            document.getElementById('gatePassword').value = password;
        }
        
        function gateLogin() {
            const password = document.getElementById('gatePassword').value;
            const deviceCheck = DeviceSecurity.verifyDevice();
            
            // Update device ID display
            document.getElementById('deviceId').textContent = deviceCheck.id;
            
            // Check device fingerprint (Architect bypasses this)
            if (deviceCheck.status === 'UNRECOGNIZED' && password !== CONFIG.passwords.GHOST) {
                showToast('üö® PERINGATAN: Device Tidak Dikenali!', 'error');
                setTimeout(() => {
                    if (confirm('Device tidak terdaftar. Laporkan ke Administrator?')) {
                        // Log unauthorized access attempt
                        console.warn('Unauthorized device attempt:', deviceCheck.id);
                    }
                }, 500);
            }
            
            // Check password
            let role = null;
            
            if (password === CONFIG.passwords.GHOST) {
                activateGhostMode(deviceCheck);
                return;
            } else if (password === CONFIG.passwords.USER) role = 'user';
            else if (password === CONFIG.passwords.ADMIN) role = 'admin';
            else if (password === CONFIG.passwords.SECURITY) role = 'security';
            else if (password === CONFIG.passwords.HRD_ACCESS) role = 'hrd';
            else if (password === CONFIG.passwords.VAULT_INV) role = 'inventory_vault';
            else if (password === CONFIG.passwords.VAULT_WH) role = 'warehouse_vault';
            else if (password === CONFIG.passwords.MASTER) role = 'master';
            
            if (role) {
                launchSystem(role, deviceCheck);
            } else {
                showToast('‚ùå Kode Akses Tidak Dikenali!', 'error');
                // Shake animation for wrong password
                document.getElementById('gatePassword').style.animation = 'shake 0.5s';
                setTimeout(() => {
                    document.getElementById('gatePassword').style.animation = '';
                }, 500);
                
                // Haptic feedback for wrong password
                if (navigator.vibrate) navigator.vibrate(200);
            }
        }

        function activateGhostMode(deviceCheck) {
            console.log('üëª Ghost Mode Activated!');
            console.log('Device ID:', deviceCheck.id);
            
            // Show ghost menu
            document.getElementById('ghostMenu').style.display = 'block';
            document.getElementById('deviceStatus').style.display = 'flex';
            document.getElementById('deviceStatus').innerHTML = `<i class="fas fa-ghost"></i> Ghost Mode`;
            
            // Launch as architect
            launchSystem('architect', deviceCheck);
            
            // Special message for architect
            setTimeout(() => {
                showSpiritualToast('Welcome home, Architect. Family Hub activated.');
            }, 1000);
        }

        function launchSystem(role, deviceCheck) {
            // Save session
            sessionStorage.setItem('dreamos_logged_in', 'true');
            sessionStorage.setItem('dreamos_user_role', role);
            sessionStorage.setItem('dreamos_device_id', deviceCheck.id);
            sessionStorage.setItem('dreamos_login_time', new Date().toISOString());
            
            // Update UI
            document.getElementById('loginGate').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('loginGate').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('mainApp').style.opacity = '1';
                
                // Update role badge
                const roleIcons = {
                    'user': 'user',
                    'admin': 'crown',
                    'security': 'shield-alt',
                    'hrd': 'users',
                    'inventory_vault': 'key',
                    'warehouse_vault': 'warehouse',
                    'master': 'star',
                    'architect': 'ghost'
                };
                
                document.getElementById('userRoleBadge').innerHTML = 
                    `<i class="fas fa-${roleIcons[role] || 'user'}"></i> ${role.toUpperCase()}`;
                
                // Show device status if not matched
                if (deviceCheck.status === 'MATCHED') {
                    document.getElementById('deviceStatus').style.display = 'flex';
                    document.getElementById('deviceStatus').innerHTML = 
                        `<i class="fas fa-check-circle"></i> Trusted Device`;
                }
                
                // Start inactivity timer
                startInactivityTimer();
                
                // Reset timer on user activity
                ['click', 'touchstart', 'keypress', 'mousemove'].forEach(event => {
                    document.addEventListener(event, resetInactivityTimer);
                });
                
                // Update smart greeting
                updateSmartGreeting();
                
                // Fetch weather
                fetchWeather();
                
                // Update audit timestamp
                updateAuditTimestamp();
                
                // Show welcome message
                showSpiritualToast(`Assalamu'alaikum, ${role.toUpperCase()}!`);
                
                // Auto-redirect HRD to HRD module
                if (role === 'hrd') {
                    setTimeout(() => openModule('hrd'), 500);
                }
                
                // Auto-redirect security to security module
                if (role === 'security') {
                    setTimeout(() => openModule('security'), 500);
                }
            }, 500);
        }

        // ========== MODULE MANAGEMENT ==========
        function openModule(moduleName) {
            // Update active dock button
            document.querySelectorAll('.dock-btn').forEach(btn => btn.classList.remove('active'));
            
            // Update title
            const titles = {
                'inventory': 'Inventory Management',
                'hrd': 'HRD Administration',
                'booking': 'Booking Sarana (22 Unit)',
                'k3': 'K3 Reports',
                'security': 'Security Reports',
                'reports': 'System Reports',
                'quantum': 'Quantum Bridge'
            };
            document.getElementById('dynamicTitle').textContent = titles[moduleName] || moduleName;
            
            // Load module content
            const container = document.getElementById('moduleContent');
            
            switch(moduleName) {
                case 'inventory':
                    container.innerHTML = `
                        <div style="padding: 1rem;">
                            <h3 style="color:var(--gold-primary); margin-bottom:1rem;">
                                <i class="fas fa-warehouse"></i> Inventory Management
                            </h3>
                            <div style="background:rgba(251,191,36,0.1); padding:15px; border-radius:12px; margin-bottom:20px; border-left:4px solid var(--gold-primary)">
                                <p style="color:var(--gold-primary); font-weight:700; margin-bottom:10px;">
                                    <i class="fas fa-qrcode"></i> QR Scanner Access
                                </p>
                                <button onclick="openScanner()" class="btn btn-primary btn-block">
                                    <i class="fas fa-expand"></i> BUKA QR SCANNER
                                </button>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                                <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 10px; text-align:center;">
                                    <div style="font-size: 1.5rem; font-weight: 800;">12</div>
                                    <div style="font-size: 0.8rem; color: var(--text-dim);">Ready</div>
                                </div>
                                <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 10px; text-align:center;">
                                    <div style="font-size: 1.5rem; font-weight: 800;">8</div>
                                    <div style="font-size: 0.8rem; color: var(--text-dim);">In Use</div>
                                </div>
                                <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 10px; text-align:center;">
                                    <div style="font-size: 1.5rem; font-weight: 800;">3</div>
                                    <div style="font-size: 0.8rem; color: var(--text-dim);">Maintenance</div>
                                </div>
                            </div>
                            <div style="margin-top: 20px;">
                                <h4 style="color:var(--text-dim); margin-bottom:10px; font-size:0.9rem;">Recent Activity</h4>
                                <div style="background:var(--bg-card); padding:10px; border-radius:10px; font-size:0.8rem;">
                                    <div style="padding:8px; border-bottom:1px solid #333;">
                                        <span style="color:var(--success)">‚úì</span> User1 checked out Proyektor
                                    </div>
                                    <div style="padding:8px; border-bottom:1px solid #333;">
                                        <span style="color:var(--warning)">‚Üª</span> Sound System in maintenance
                                    </div>
                                    <div style="padding:8px;">
                                        <span style="color:var(--info)">‚úì</span> Inventory audit completed
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    document.querySelector('.dock-btn:nth-child(2)').classList.add('active');
                    break;
                    
                case 'hrd':
                    container.innerHTML = `
                        <div style="padding: 1rem;">
                            <h3 style="color:var(--gold-primary); margin-bottom:1rem;">
                                <i class="fas fa-users"></i> HRD Administration
                            </h3>
                            <div style="background:rgba(139,92,246,0.1); padding:15px; border-radius:12px; margin-bottom:20px; border-left:4px solid var(--purple)">
                                <p style="color:var(--purple); font-weight:700; margin-bottom:10px;">
                                    <i class="fas fa-shield-alt"></i> Data Privacy Protection Active
                                </p>
                                <div style="font-size:0.8rem; color:var(--text-dim);">
                                    Staff data encrypted with Base64 security
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 20px;">
                                <div style="background: var(--bg-card); padding: 1rem; border-radius: 10px; text-align: left;">
                                    <div style="font-weight: 800; color:var(--gold-primary); margin-bottom:5px;">Total Staff: 24</div>
                                    <div style="font-size: 0.8rem; color: var(--text-dim);">
                                        SD: 8 | SMP: 7 | SMA: 9
                                    </div>
                                </div>
                                <div style="background: var(--bg-card); padding: 1rem; border-radius: 10px; text-align: left;">
                                    <div style="font-weight: 800; color:var(--info); margin-bottom:5px;">Present Today: 22</div>
                                    <div style="font-size: 0.8rem; color: var(--text-dim);">
                                        Absent: 2 (Ijin: 1, Sakit: 1)
                                    </div>
                                </div>
                            </div>
                            <div style="margin-top: 20px;">
                                <button onclick="showHrdForm()" class="btn btn-primary btn-block">
                                    <i class="fas fa-user-plus"></i> TAMBAH STAFF BARU
                                </button>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'booking':
                    renderBookingModule();
                    break;
                    
                case 'k3':
                    renderK3Module();
                    break;
                    
                case 'security':
                    renderSecurityModule();
                    break;
                    
                case 'reports':
                    container.innerHTML = `
                        <div style="padding: 1rem;">
                            <h3 style="color:var(--gold-primary); margin-bottom:1rem;">
                                <i class="fas fa-chart-bar"></i> System Reports
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                                <div style="background: var(--bg-card); padding: 1rem; border-radius: 10px; text-align: center;">
                                    <div style="font-size: 2rem; color:var(--gold-primary); margin-bottom:5px;">${STATE.bookingData.length}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-dim);">Active Bookings</div>
                                </div>
                                <div style="background: var(--bg-card); padding: 1rem; border-radius: 10px; text-align: center;">
                                    <div style="font-size: 2rem; color:var(--success); margin-bottom:5px;">${STATE.k3Data.length}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-dim);">K3 Reports</div>
                                </div>
                                <div style="background: var(--bg-card); padding: 1rem; border-radius: 10px; text-align: center;">
                                    <div style="font-size: 2rem; color:var(--info); margin-bottom:5px;">${STATE.securityData.length}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-dim);">Security Reports</div>
                                </div>
                                <div style="background: var(--bg-card); padding: 1rem; border-radius: 10px; text-align: center;">
                                    <div style="font-size: 2rem; color:var(--warning); margin-bottom:5px;">${STATE.shalawatCount}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-dim);">Shalawat Sent</div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'quantum':
                    container.innerHTML = `
                        <div style="padding: 1rem; text-align: center;">
                            <i class="fas fa-satellite-dish" style="font-size: 3rem; color: var(--info); margin-bottom: 1rem;"></i>
                            <h3 style="margin-bottom: 1rem; color: var(--gold-primary);">Quantum Bridge</h3>
                            <p style="color: var(--text-dim); margin-bottom: 2rem;">Real-time Data Sync Status</p>
                            <div style="background: rgba(59, 130, 246, 0.1); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--info);">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span style="color: var(--text-dim);">System Status:</span>
                                    <span style="color: var(--success); font-weight: 700;">ONLINE</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span style="color: var(--text-dim);">Last Sync:</span>
                                    <span style="color: var(--gold-primary);">${new Date().toLocaleTimeString('id-ID')}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--text-dim);">Data Integrity:</span>
                                    <span style="color: var(--success); font-weight: 700;">100%</span>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                default:
                    showDashboard();
            }
            
            STATE.currentModule = moduleName;
        }

        function showDashboard() {
            const container = document.getElementById('moduleContent');
            container.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <i class="fas fa-home" style="font-size: 3rem; margin-bottom: 1rem; color: var(--gold-primary);"></i>
                    <h3 style="margin-bottom: 1rem; color: var(--gold-primary);" id="smartGreeting">${STATE.dailyGreeting || "Welcome to DREAM OS v13.0"}</h3>
                    <p id="greetingSubtitle">${STATE.weatherData.condition === "Rainy" ? "‚õàÔ∏è Hujan di Al-Fikri, waspada titik genangan!" : "Select a module from the dashboard to begin"}</p>
                    
                    <div style="margin-top: 2rem; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div style="background: rgba(251, 191, 36, 0.1); padding: 1rem; border-radius: 10px; border: 1px solid rgba(251, 191, 36, 0.3);">
                            <div style="font-size: 1.2rem; font-weight: 800; color: var(--gold-primary);">${STATE.bookingData.length}</div>
                            <div style="font-size: 0.8rem; color: var(--text-dim);">Active Bookings</div>
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 10px; border: 1px solid rgba(16, 185, 129, 0.3);">
                            <div style="font-size: 1.2rem; font-weight: 800; color: var(--success);">${STATE.securityData.length}</div>
                            <div style="font-size: 0.8rem; color: var(--text-dim);">Security Reports</div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('dynamicTitle').textContent = 'DREAM OS v13.0';
            document.querySelectorAll('.dock-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.dock-btn:first-child').classList.add('active');
        }

        // ========== BOOKING MODULE ==========
        function renderBookingModule() {
            const container = document.getElementById('moduleContent');
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            
            container.innerHTML = `
                <div style="padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color:var(--gold-primary)">
                            <i class="fas fa-calendar-check"></i> Booking Sarana (22 Unit)
                        </h3>
                        <button onclick="showBookingForm()" class="btn btn-success">
                            <i class="fas fa-plus"></i> BOOKING BARU
                        </button>
                    </div>
                    
                    ${renderBookingRulesInfo()}
                    
                    <div style="margin-top: 1.5rem;">
                        <h4 style="color:var(--text-dim); margin-bottom:1rem; font-size:0.9rem;">
                            <i class="fas fa-clock"></i> BOOKING AKTIF HARI INI
                        </h4>
                        <div id="bookingList">
                            ${renderActiveBookings()}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderBookingRulesInfo() {
            const now = new Date();
            const day = now.getDay();
            const hour = now.getHours();
            
            let rulesHtml = '<div style="background:rgba(251,191,36,0.1); padding:15px; border-radius:12px; margin-bottom:20px; border-left:4px solid var(--gold-primary)">';
            rulesHtml += '<p style="color:var(--gold-primary); font-weight:700; margin-bottom:10px;"><i class="fas fa-info-circle"></i> ATURAN BOOKING</p>';
            
            if (day === 0) {
                rulesHtml += '<p style="color:var(--danger); font-size:0.9rem;">‚ùå HARI MINGGU: Sistem terkunci total (kecuali Security)</p>';
            } else if (day === 6) {
                rulesHtml += '<p style="color:var(--warning); font-size:0.9rem;">‚ö†Ô∏è SABTU: System Cancel - Konfirmasi WA Pak Erwin wajib!</p>';
            } else if (day === 5 && hour >= 10.5 && hour <= 13) {
                rulesHtml += '<p style="color:var(--warning); font-size:0.9rem;">üïå JUMAT 10:30-13:00: Lock untuk shalat Jumat</p>';
            } else if (hour < 7.5 || hour > 16) {
                rulesHtml += '<p style="color:var(--danger); font-size:0.9rem;">üåô LUAR JAM KERJA (07:30-16:00): Booking tidak tersedia</p>';
            } else {
                rulesHtml += '<p style="color:var(--success); font-size:0.9rem;">‚úÖ Jam Kerja Normal: 07:30 - 16:00</p>';
            }
            
            rulesHtml += '<p style="color:var(--info); font-size:0.9rem; margin-top:10px;">üìå Minimal H-1 (1 hari sebelumnya)</p>';
            rulesHtml += '</div>';
            
            return rulesHtml;
        }

        function renderActiveBookings() {
            const today = new Date().toISOString().split('T')[0];
            const todayBookings = STATE.bookingData.filter(booking => 
                booking.date.split('T')[0] === today && !booking.cancelled
            );
            
            if (todayBookings.length === 0) {
                return '<div style="background:var(--bg-card); padding:1.5rem; border-radius:12px; text-align:center; opacity:0.7;"><p style="color:var(--text-dim)">Belum ada jadwal booking hari ini.</p></div>';
            }
            
            return todayBookings.map(booking => `
                <div style="background:var(--bg-card); padding:1rem; border-radius:12px; margin-bottom:10px; border-left:4px solid var(--success); position:relative;">
                    <div style="font-weight:800; color:var(--gold-primary); margin-bottom:5px;">${booking.facility}</div>
                    <div style="font-size:0.8rem; color:var(--text-dim); margin-bottom:5px;">
                        <i class="fas fa-user"></i> ${booking.pic} (${booking.division})
                    </div>
                    <div style="font-size:0.8rem; color:var(--info); margin-bottom:5px;">
                        <i class="fas fa-clock"></i> ${booking.timeStart} - ${booking.timeEnd}
                    </div>
                    ${booking.equipment ? `<div style="font-size:0.7rem; color:var(--text-dim);">+ ${booking.equipment}</div>` : ''}
                    <button onclick="cancelBooking('${booking.id}')" style="position:absolute; right:10px; top:10px; background:none; border:none; color:var(--danger); font-size:0.8rem;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        function showBookingForm() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const minDate = tomorrow.toISOString().split('T')[0];
            
            // Check if booking is allowed
            const day = now.getDay();
            const hour = now.getHours();
            
            if (day === 0) {
                showToast('‚ùå HARI MINGGU: Sistem terkunci total!', 'error');
                return;
            }
            
            if (day === 6) {
                // Sabtu - redirect to WA Pak Erwin
                const waMsg = "üì¢ *KONFIRMASI BOOKING SABTU*%0A%0ASaya ingin booking sarana untuk hari Sabtu. Mohon persetujuan Pak Erwin.";
                window.open(`https://wa.me/628886183954?text=${waMsg}`, '_blank');
                showToast('‚ö†Ô∏è SABTU: Konfirmasi manual ke Pak Erwin via WA!', 'warning');
                return;
            }
            
            if (hour < 7.5 || hour > 16) {
                showToast('‚ùå LUAR JAM KERJA (07:30-16:00)!', 'error');
                return;
            }
            
            const container = document.getElementById('moduleContent');
            container.innerHTML = `
                <div style="padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color:var(--gold-primary)">
                            <i class="fas fa-calendar-plus"></i> FORM BOOKING BARU
                        </h3>
                        <button onclick="renderBookingModule()" class="btn" style="background:var(--danger); color:white;">
                            <i class="fas fa-times"></i> BATAL
                        </button>
                    </div>
                    
                    <form id="bookingForm" onsubmit="submitBooking(event)">
                        <div class="form-group">
                            <label class="form-label">Nama PIC / Pemohon</label>
                            <input type="text" class="form-input" id="bookingPic" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">No. WhatsApp</label>
                            <input type="tel" class="form-input" id="bookingPhone" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Divisi</label>
                            <select class="form-select" id="bookingDivision" required>
                                <option value="">Pilih Divisi</option>
                                ${CONFIG.divisions.map(div => `<option value="${div}">${div}</option>`).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Tanggal Penggunaan</label>
                            <input type="date" class="form-input" id="bookingDate" min="${minDate}" required>
                            <small style="color:var(--text-dim); font-size:0.8rem;">Minimal H-1 (besok)</small>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Jam Mulai</label>
                                <input type="time" class="form-input" id="bookingStart" min="07:30" max="16:00" value="08:00" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Jam Selesai</label>
                                <input type="time" class="form-input" id="bookingEnd" min="07:30" max="16:00" value="12:00" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Pilih Sarana</label>
                            <select class="form-select" id="bookingFacility" required>
                                <option value="">Pilih Sarana</option>
                                ${CONFIG.facilities.map(facility => `<option value="${facility}">${facility}</option>`).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Alat Tambahan (Opsional)</label>
                            <select class="form-select" id="bookingEquipment" multiple style="height:100px;">
                                ${CONFIG.equipment.map(eq => `<option value="${eq}">${eq}</option>`).join('')}
                            </select>
                            <small style="color:var(--text-dim); font-size:0.8rem;">Tahan Ctrl untuk pilih banyak</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Keperluan / Acara</label>
                            <textarea class="form-textarea" id="bookingPurpose" placeholder="Contoh: Rapat orang tua murid, Seminar, Acara sekolah, dll."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-paper-plane"></i> KIRIM PERMOHONAN BOOKING
                        </button>
                    </form>
                </div>
            `;
        }

        function submitBooking(event) {
            event.preventDefault();
            
            const pic = document.getElementById('bookingPic').value;
            const phone = document.getElementById('bookingPhone').value;
            const division = document.getElementById('bookingDivision').value;
            const date = document.getElementById('bookingDate').value;
            const timeStart = document.getElementById('bookingStart').value;
            const timeEnd = document.getElementById('bookingEnd').value;
            const facility = document.getElementById('bookingFacility').value;
            const equipment = Array.from(document.getElementById('bookingEquipment').selectedOptions).map(opt => opt.value).join(', ');
            const purpose = document.getElementById('bookingPurpose').value;
            
            // Validate date (H-1 rule)
            const selectedDate = new Date(date);
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            if (selectedDate < tomorrow) {
                showToast('‚ùå MINIMAL H-1: Booking harus dilakukan minimal 1 hari sebelumnya!', 'error');
                return;
            }
            
            // Validate time (working hours)
            const [startHour, startMinute] = timeStart.split(':').map(Number);
            const [endHour, endMinute] = timeEnd.split(':').map(Number);
            const startTime = startHour + (startMinute / 60);
            const endTime = endHour + (endMinute / 60);
            
            if (startTime < 7.5 || endTime > 16 || startTime >= endTime) {
                showToast('‚ùå WAKTU TIDAK VALID! Harus antara 07:30 - 16:00', 'error');
                return;
            }
            
            // Check Friday prayer time lock
            const day = selectedDate.getDay();
            if (day === 5) { // Friday
                if ((startTime >= 10.5 && startTime <= 13) || (endTime >= 10.5 && endTime <= 13)) {
                    showToast('‚ùå JUMAT 10:30-13:00: Lock untuk shalat Jumat!', 'error');
                    return;
                }
            }
            
            // Create booking object
            const booking = {
                id: 'BOOK-' + Date.now(),
                pic,
                phone,
                division,
                date: selectedDate.toISOString(),
                timeStart,
                timeEnd,
                facility,
                equipment: equipment || 'Tidak ada',
                purpose: purpose || 'Tidak disebutkan',
                createdAt: new Date().toISOString(),
                cancelled: false,
                status: 'pending'
            };
            
            // Save to state and localStorage
            STATE.bookingData.unshift(booking);
            localStorage.setItem('DREAMOS_BOOKINGS', JSON.stringify(STATE.bookingData));
            
            // Show success message
            showSpiritualToast('Booking berhasil dikirim! Allahumma Sholli \'ala Muhammad');
            
            // Return to booking module
            renderBookingModule();
        }

        function cancelBooking(bookingId) {
            if (confirm('Batalkan booking ini?')) {
                const booking = STATE.bookingData.find(b => b.id === bookingId);
                if (booking) {
                    booking.cancelled = true;
                    booking.cancelledAt = new Date().toISOString();
                    localStorage.setItem('DREAMOS_BOOKINGS', JSON.stringify(STATE.bookingData));
                    
                    showToast('Booking berhasil dibatalkan', 'success');
                    renderBookingModule();
                }
            }
        }

        // ========== K3 MODULE ==========
        function renderK3Module() {
            const container = document.getElementById('moduleContent');
            container.innerHTML = `
                <div style="padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color:var(--gold-primary)">
                            <i class="fas fa-shield-alt"></i> K3 Reports
                            <span class="badge badge-info" style="margin-left:10px;">Kerusakan ‚Ä¢ Kehilangan ‚Ä¢ Kebersihan</span>
                        </h3>
                        <button onclick="showK3Form()" class="btn btn-success">
                            <i class="fas fa-plus"></i> LAPOR BARU
                        </button>
                    </div>
                    
                    <div style="background:rgba(245,158,11,0.1); padding:15px; border-radius:12px; margin-bottom:20px; border-left:4px solid var(--warning)">
                        <p style="color:var(--warning); font-weight:700; margin-bottom:10px;">
                            <i class="fas fa-info-circle"></i> ATURAN LAPORAN K3
                        </p>
                        <p style="color:var(--text-dim); font-size:0.9rem;">
                            Laporan K3 aktif jam 07:30 - 16:00. Di luar jam ini, sistem akan merekam dan mengingatkan untuk dilaporkan besok pagi.
                        </p>
                    </div>
                    
                    <div style="margin-top: 1.5rem;">
                        <h4 style="color:var(--text-dim); margin-bottom:1rem; font-size:0.9rem;">
                            <i class="fas fa-history"></i> LAPORAN TERAKHIR
                        </h4>
                        <div id="k3List">
                            ${renderK3Reports()}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderK3Reports() {
            if (STATE.k3Data.length === 0) {
                return '<div style="background:var(--bg-card); padding:1.5rem; border-radius:12px; text-align:center; opacity:0.7;"><p style="color:var(--text-dim)">Belum ada laporan K3.</p></div>';
            }
            
            return STATE.k3Data.slice(0, 10).map(report => `
                <div style="background:var(--bg-card); padding:1rem; border-radius:12px; margin-bottom:10px; border-left:4px solid ${getK3Color(report.type)};">
                    <div style="font-weight:800; color:var(--gold-primary); margin-bottom:5px;">
                        ${report.type.toUpperCase()}: ${report.location}
                    </div>
                    <div style="font-size:0.8rem; color:var(--text-dim); margin-bottom:5px;">
                        <i class="fas fa-user"></i> ${report.reporter} ‚Ä¢ ${new Date(report.date).toLocaleDateString('id-ID')}
                    </div>
                    <div style="font-size:0.8rem; color:white;">
                        ${report.description}
                    </div>
                    ${report.status !== 'pending' ? `
                        <div style="margin-top:5px;">
                            <span class="badge ${report.status === 'resolved' ? 'badge-success' : 'badge-warning'}">
                                ${report.status === 'resolved' ? 'SELESAI' : 'DIPROSES'}
                            </span>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function getK3Color(type) {
            const colors = {
                'kerusakan': 'var(--danger)',
                'kehilangan': 'var(--warning)',
                'kebersihan': 'var(--info)'
            };
            return colors[type] || 'var(--text-dim)';
        }

        function showK3Form() {
            const now = new Date();
            const hour = now.getHours();
            
            // Check if K3 reporting is allowed
            if (hour < 7.5 || hour > 16) {
                if (!confirm('Luar jam kerja (07:30-16:00). Laporan akan disimpan dan dilaporkan besok pagi. Lanjutkan?')) {
                    return;
                }
            }
            
            const container = document.getElementById('moduleContent');
            container.innerHTML = `
                <div style="padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color:var(--gold-primary)">
                            <i class="fas fa-clipboard-list"></i> FORM LAPORAN K3
                        </h3>
                        <button onclick="renderK3Module()" class="btn" style="background:var(--danger); color:white;">
                            <i class="fas fa-times"></i> BATAL
                        </button>
                    </div>
                    
                    <form id="k3Form" onsubmit="submitK3Report(event)">
                        <div class="form-group">
                            <label class="form-label">Nama Pelapor</label>
                            <input type="text" class="form-input" id="k3Reporter" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Jenis Laporan</label>
                            <select class="form-select" id="k3Type" required>
                                <option value="">Pilih Jenis</option>
                                <option value="kerusakan">Kerusakan</option>
                                <option value="kehilangan">Kehilangan</option>
                                <option value="kebersihan">Kebersihan</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Lokasi Kejadian</label>
                            <select class="form-select" id="k3Location" required>
                                <option value="">Pilih Lokasi</option>
                                ${CONFIG.facilities.map(facility => `<option value="${facility}">${facility}</option>`).join('')}
                                <option value="lainnya">Lainnya</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="otherLocationGroup" style="display:none;">
                            <label class="form-label">Sebutkan Lokasi</label>
                            <input type="text" class="form-input" id="k3OtherLocation">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Deskripsi Detail</label>
                            <textarea class="form-textarea" id="k3Description" 
                                      placeholder="Jelaskan secara detail: apa yang terjadi, kondisi saat ini, tindakan sementara yang sudah dilakukan, dll."
                                      required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Tingkat Urgensi</label>
                            <select class="form-select" id="k3Urgency" required>
                                <option value="rendah">Rendah (bisa ditunda)</option>
                                <option value="sedang">Sedang (perlu segera ditangani)</option>
                                <option value="tinggi">Tinggi (membahayakan/genting)</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-paper-plane"></i> KIRIM LAPORAN K3
                        </button>
                    </form>
                </div>
            `;
            
            // Show/hide other location input
            document.getElementById('k3Location').addEventListener('change', function() {
                const otherGroup = document.getElementById('otherLocationGroup');
                otherGroup.style.display = this.value === 'lainnya' ? 'block' : 'none';
            });
        }

        function submitK3Report(event) {
            event.preventDefault();
            
            const reporter = document.getElementById('k3Reporter').value;
            const type = document.getElementById('k3Type').value;
            const location = document.getElementById('k3Location').value;
            const actualLocation = location === 'lainnya' 
                ? document.getElementById('k3OtherLocation').value 
                : location;
            const description = document.getElementById('k3Description').value;
            const urgency = document.getElementById('k3Urgency').value;
            
            if (!actualLocation) {
                showToast('Harap isi lokasi kejadian!', 'error');
                return;
            }
            
            // Create K3 report object
            const report = {
                id: 'K3-' + Date.now(),
                reporter,
                type,
                location: actualLocation,
                description,
                urgency,
                date: new Date().toISOString(),
                status: 'pending',
                resolvedBy: null,
                resolvedAt: null
            };
            
            // Save to state and localStorage
            STATE.k3Data.unshift(report);
            localStorage.setItem('DREAMOS_K3', JSON.stringify(STATE.k3Data));
            
            // Show success message
            const now = new Date();
            const hour = now.getHours();
            let message = 'Laporan K3 berhasil disimpan!';
            
            if (hour < 7.5 || hour > 16) {
                message = 'Laporan K3 disimpan untuk dilaporkan besok pagi!';
            }
            
            showSpiritualToast(message);
            
            // Return to K3 module
            renderK3Module();
        }

        // ========== SECURITY MODULE ==========
        function renderSecurityModule() {
            const container = document.getElementById('moduleContent');
            const now = new Date();
            const hour = now.getHours();
            const shift = hour >= 7 && hour < 19 ? CONFIG.securityShifts[0] : CONFIG.securityShifts[1];
            
            container.innerHTML = `
                <div style="padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color:var(--gold-primary)">
                            <i class="fas fa-user-shield"></i> Security Reports (24 Jam)
                            <span class="badge badge-success" style="margin-left:10px;">${shift.name}</span>
                        </h3>
                        <button onclick="showSecurityForm()" class="btn btn-success">
                            <i class="fas fa-plus"></i> LAPOR BARU
                        </button>
                    </div>
                    
                    <div style="background:rgba(16,185,129,0.1); padding:15px; border-radius:12px; margin-bottom:20px; border-left:4px solid var(--success)">
                        <p style="color:var(--success); font-weight:700; margin-bottom:10px;">
                            <i class="fas fa-info-circle"></i> SHIFT SYSTEM (12 Jam)
                        </p>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            ${CONFIG.securityShifts.map(s => `
                                <div style="background:${s.id === shift.id ? 'rgba(16,185,129,0.3)' : 'rgba(255,255,255,0.05)'}; padding:10px; border-radius:8px; text-align:center;">
                                    <div style="font-weight:700; color:${s.id === shift.id ? 'var(--success)' : 'var(--text-dim)'};">${s.name}</div>
                                    <div style="font-size:0.8rem; color:var(--text-dim);">${s.time}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    ${renderShiftHandover()}
                    
                    <div style="margin-top: 1.5rem;">
                        <h4 style="color:var(--text-dim); margin-bottom:1rem; font-size:0.9rem;">
                            <i class="fas fa-history"></i> LAPORAN KEAMANAN TERAKHIR
                        </h4>
                        <div id="securityList">
                            ${renderSecurityReports()}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderShiftHandover() {
            const lastHandover = localStorage.getItem('DREAMOS_LAST_HANDOVER');
            const now = new Date();
            const hour = now.getHours();
            const isShiftChange = (hour === 7 || hour === 19);
            
            if (isShiftChange || !lastHandover) {
                const shiftType = hour === 7 ? 'Pagi' : 'Malam';
                return `
                    <div style="background:rgba(239,68,68,0.1); padding:15px; border-radius:12px; margin-bottom:20px; border-left:4px solid var(--danger)">
                        <p style="color:var(--danger); font-weight:700; margin-bottom:10px;">
                            <i class="fas fa-exchange-alt"></i> ABSEN PERGANTIAN SHIFT ${shiftType}
                        </p>
                        <p style="color:var(--text-dim); font-size:0.9rem; margin-bottom:15px;">
                            Wajib absen dan isi berita acara serah terima sebelum melanjutkan patroli.
                        </p>
                        <button onclick="showHandoverForm()" class="btn btn-danger btn-block">
                            <i class="fas fa-clipboard-check"></i> ISI BERITA ACARA SERAH TERIMA
                        </button>
                    </div>
                `;
            }
            
            return '';
        }

        function renderSecurityReports() {
            if (STATE.securityData.length === 0) {
                return '<div style="background:var(--bg-card); padding:1.5rem; border-radius:12px; text-align:center; opacity:0.7;"><p style="color:var(--text-dim)">Belum ada laporan keamanan.</p></div>';
            }
            
            return STATE.securityData.slice(0, 10).map(report => `
                <div style="background:var(--bg-card); padding:1rem; border-radius:12px; margin-bottom:10px; border-left:4px solid ${getSecurityColor(report.urgency)};">
                    <div style="font-weight:800; color:var(--gold-primary); margin-bottom:5px;">
                        ${report.title || 'Laporan Patroli'}
                    </div>
                    <div style="font-size:0.8rem; color:var(--text-dim); margin-bottom:5px;">
                        <i class="fas fa-user-shield"></i> ${report.officer} ‚Ä¢ 
                        ${new Date(report.date).toLocaleString('id-ID')} ‚Ä¢ 
                        <span class="badge ${getSecurityBadgeClass(report.urgency)}">${report.urgency.toUpperCase()}</span>
                    </div>
                    <div style="font-size:0.8rem; color:white; margin-bottom:5px;">
                        ${report.incident}
                    </div>
                    ${report.action ? `
                        <div style="font-size:0.8rem; color:var(--info);">
                            <i class="fas fa-check-circle"></i> Tindakan: ${report.action}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function getSecurityColor(urgency) {
            const colors = {
                'normal': 'var(--info)',
                'waspada': 'var(--warning)',
                'darurat': 'var(--danger)'
            };
            return colors[urgency] || 'var(--text-dim)';
        }

        function getSecurityBadgeClass(urgency) {
            const classes = {
                'normal': 'badge-info',
                'waspada': 'badge-warning',
                'darurat': 'badge-danger'
            };
            return classes[urgency] || 'badge-info';
        }

        function showSecurityForm() {
            const container = document.getElementById('moduleContent');
            container.innerHTML = `
                <div style="padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color:var(--gold-primary)">
                            <i class="fas fa-file-contract"></i> FORM LAPORAN SECURITY (A4 Format)
                        </h3>
                        <button onclick="renderSecurityModule()" class="btn" style="background:var(--danger); color:white;">
                            <i class="fas fa-times"></i> BATAL
                        </button>
                    </div>
                    
                    <div class="a4-report">
                        <div class="report-header">
                            <div class="report-title">LAPORAN HARIAN PETUGAS KEAMANAN</div>
                            <div class="report-subtitle">MA SALAFIYAH AL FIKRI - SISTEM DREAM OS v13.0</div>
                        </div>
                        
                        <form id="securityForm" onsubmit="submitSecurityReport(event)">
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Nama Petugas</label>
                                <input type="text" style="width:100%; padding:5px; border:1px solid #ccc;" id="securityOfficer" required>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Shift</label>
                                <select style="width:100%; padding:5px; border:1px solid #ccc;" id="securityShift" required>
                                    <option value="">Pilih Shift</option>
                                    ${CONFIG.securityShifts.map(s => `<option value="${s.name}">${s.name} (${s.time})</option>`).join('')}
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Hari/Tanggal</label>
                                <input type="datetime-local" style="width:100%; padding:5px; border:1px solid #ccc;" 
                                       id="securityDate" value="${new Date().toISOString().slice(0, 16)}" required>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Tingkat Urgensi</label>
                                <select style="width:100%; padding:5px; border:1px solid #ccc;" id="securityUrgency" required>
                                    <option value="normal">Normal (rutin patroli)</option>
                                    <option value="waspada">Waspada (ada kejadian khusus)</option>
                                    <option value="darurat">Darurat (butuh tindakan segera)</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Kejadian Menonjol</label>
                                <textarea style="width:100%; padding:5px; border:1px solid #ccc; min-height:80px;" 
                                          id="securityIncident" 
                                          placeholder="Jelaskan kejadian yang perlu dilaporkan (orang mencurigakan, kendaraan tidak dikenal, kerusakan fasilitas, dll.)"
                                          required></textarea>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Kondisi Gerbang</label>
                                <div>
                                    <label><input type="radio" name="gateCondition" value="aman" checked> Aman/Terkunci</label><br>
                                    <label><input type="radio" name="gateCondition" value="perlu_perhatian"> Perlu Perhatian</label><br>
                                    <label><input type="radio" name="gateCondition" value="masalah"> Ada Masalah</label>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Kontrol Keliling (Patroli)</label>
                                <textarea style="width:100%; padding:5px; border:1px solid #ccc; min-height:60px;" 
                                          id="securityPatrol" 
                                          placeholder="Lokasi yang sudah dipatroli dan kondisi yang ditemukan"></textarea>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Tindakan yang Dilakukan</label>
                                <textarea style="width:100%; padding:5px; border:1px solid #ccc; min-height:60px;" 
                                          id="securityAction" 
                                          placeholder="Tindakan yang sudah dilakukan terhadap kejadian yang ditemukan"></textarea>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Catatan Tambahan</label>
                                <textarea style="width:100%; padding:5px; border:1px solid #ccc; min-height:60px;" 
                                          id="securityNotes"></textarea>
                            </div>
                            
                            <button type="submit" style="width:100%; padding:10px; background:#0066cc; color:white; border:none; font-weight:bold; cursor:pointer;">
                                <i class="fas fa-print"></i> SIMPAN LAPORAN (FORMAT A4)
                            </button>
                        </form>
                    </div>
                </div>
            `;
        }

        function showHandoverForm() {
            const now = new Date();
            const hour = now.getHours();
            const shiftType = hour === 7 ? 'Pagi' : 'Malam';
            const previousShift = hour === 7 ? 'Malam' : 'Pagi';
            
            const container = document.getElementById('moduleContent');
            container.innerHTML = `
                <div style="padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color:var(--gold-primary)">
                            <i class="fas fa-exchange-alt"></i> BERITA ACARA SERAH TERIMA SHIFT
                        </h3>
                        <button onclick="renderSecurityModule()" class="btn" style="background:var(--danger); color:white;">
                            <i class="fas fa-times"></i> BATAL
                        </button>
                    </div>
                    
                    <div class="a4-report">
                        <div class="report-header">
                            <div class="report-title">BERITA ACARA SERAH TERIMA JAGA</div>
                            <div class="report-subtitle">SHIFT ${previousShift.toUpperCase()} ‚Üí SHIFT ${shiftType.toUpperCase()}</div>
                        </div>
                        
                        <form id="handoverForm" onsubmit="submitHandoverReport(event)">
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Petugas Shift ${previousShift}</label>
                                <input type="text" style="width:100%; padding:5px; border:1px solid #ccc;" 
                                       id="previousOfficer" placeholder="Nama petugas yang akan digantikan" required>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Petugas Shift ${shiftType}</label>
                                <input type="text" style="width:100%; padding:5px; border:1px solid #ccc;" 
                                       id="currentOfficer" placeholder="Nama petugas pengganti" required>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Waktu Serah Terima</label>
                                <input type="datetime-local" style="width:100%; padding:5px; border:1px solid #ccc;" 
                                       id="handoverTime" value="${new Date().toISOString().slice(0, 16)}" required>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Jumlah Kunci yang Diserahkan</label>
                                <input type="number" style="width:100%; padding:5px; border:1px solid #ccc;" 
                                       id="keyCount" min="0" value="0" required>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Inventaris yang Diserahkan</label>
                                <textarea style="width:100%; padding:5px; border:1px solid #ccc; min-height:80px;" 
                                          id="inventoryHandover" 
                                          placeholder="Daftar inventaris yang diserahkan: senter, handy talky, peluit, dll."></textarea>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Laporan Khusus dari Shift ${previousShift}</label>
                                <textarea style="width:100%; padding:5px; border:1px solid #ccc; min-height:100px;" 
                                          id="previousReport" 
                                          placeholder="Kejadian penting, area yang perlu diperhatikan, masalah yang belum terselesaikan, dll."></textarea>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display:block; font-weight:bold; margin-bottom:5px;">Kondisi Umum Saat Ini</label>
                                <div>
                                    <label><input type="radio" name="overallCondition" value="aman" checked> Semua Aman</label><br>
                                    <label><input type="radio" name="overallCondition" value="waspada"> Kondisi Waspada</label><br>
                                    <label><input type="radio" name="overallCondition" value="darurat"> Kondisi Darurat</label>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 15px; text-align:center;">
                                <p style="font-weight:bold;">TANDA TANGAN DIGITAL</p>
                                <div style="display:flex; justify-content:space-around; margin-top:20px;">
                                    <div style="text-align:center;">
                                        <p>Petugas Shift ${previousShift}</p>
                                        <div style="border-bottom:1px solid #000; width:200px; height:50px; margin:0 auto;"></div>
                                        <p><input type="text" placeholder="Nama jelas" style="border:none; text-align:center; width:200px;"></p>
                                    </div>
                                    <div style="text-align:center;">
                                        <p>Petugas Shift ${shiftType}</p>
                                        <div style="border-bottom:1px solid #000; width:200px; height:50px; margin:0 auto;"></div>
                                        <p><input type="text" placeholder="Nama jelas" style="border:none; text-align:center; width:200px;"></p>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" style="width:100%; padding:10px; background:#006600; color:white; border:none; font-weight:bold; cursor:pointer;">
                                <i class="fas fa-check-circle"></i> KONFIRMASI SERAH TERIMA
                            </button>
                        </form>
                    </div>
                </div>
            `;
        }

        function submitSecurityReport(event) {
            event.preventDefault();
            
            const officer = document.getElementById('securityOfficer').value;
            const shift = document.getElementById('securityShift').value;
            const date = document.getElementById('securityDate').value;
            const urgency = document.getElementById('securityUrgency').value;
            const incident = document.getElementById('securityIncident').value;
            const gateCondition = document.querySelector('input[name="gateCondition"]:checked').value;
            const patrol = document.getElementById('securityPatrol').value;
            const action = document.getElementById('securityAction').value;
            const notes = document.getElementById('securityNotes').value;
            
            // Create security report object
            const report = {
                id: 'SEC-' + Date.now(),
                officer,
                shift,
                date: new Date(date).toISOString(),
                urgency,
                incident,
                gateCondition,
                patrol: patrol || 'Tidak ada patroli khusus',
                action: action || 'Tidak ada tindakan khusus',
                notes: notes || 'Tidak ada catatan',
                createdAt: new Date().toISOString()
            };
            
            // Save to state and localStorage
            STATE.securityData.unshift(report);
            localStorage.setItem('DREAMOS_SECURITY', JSON.stringify(STATE.securityData));
            
            // Show success message
            showSpiritualToast('Laporan Security berhasil disimpan!');
            
            // Return to security module
            renderSecurityModule();
        }

        function submitHandoverReport(event) {
            event.preventDefault();
            
            const previousOfficer = document.getElementById('previousOfficer').value;
            const currentOfficer = document.getElementById('currentOfficer').value;
            const handoverTime = document.getElementById('handoverTime').value;
            const keyCount = document.getElementById('keyCount').value;
            const inventory = document.getElementById('inventoryHandover').value;
            const previousReport = document.getElementById('previousReport').value;
            const overallCondition = document.querySelector('input[name="overallCondition"]:checked').value;
            
            // Save handover record
            const handover = {
                id: 'HANDOVER-' + Date.now(),
                previousOfficer,
                currentOfficer,
                handoverTime: new Date(handoverTime).toISOString(),
                keyCount,
                inventory: inventory || 'Tidak ada',
                previousReport: previousReport || 'Tidak ada laporan khusus',
                overallCondition,
                recordedAt: new Date().toISOString()
            };
            
            // Save to localStorage
            localStorage.setItem('DREAMOS_LAST_HANDOVER', JSON.stringify(handover));
            
            // Show success message
            showSpiritualToast('Berita acara serah terima berhasil dicatat!');
            
            // Return to security module
            renderSecurityModule();
        }

        // ========== SCANNER SYSTEM ==========
        function openScanner() {
            const container = document.getElementById('moduleContent');
            container.innerHTML = `
                <div style="padding: 1rem; text-align: center;">
                    <h3 style="color:var(--gold-primary); margin-bottom:1rem;">
                        <i class="fas fa-expand"></i> QUANTUM VISION SCANNER
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 2rem;">
                        <button onclick="startCameraScanner('inventory')" class="btn btn-primary" style="padding:15px;">
                            <i class="fas fa-qrcode"></i><br>
                            SCAN INVENTARIS
                        </button>
                        <button onclick="startCameraScanner('k3')" class="btn btn-warning" style="padding:15px; background:var(--warning); color:black;">
                            <i class="fas fa-camera"></i><br>
                            FOTO LAPORAN K3
                        </button>
                    </div>
                    
                    <div style="background:rgba(59,130,246,0.1); padding:15px; border-radius:12px; border-left:4px solid var(--info);">
                        <p style="color:var(--info); font-weight:700; margin-bottom:10px;">
                            <i class="fas fa-lightbulb"></i> TIPS PENGGUNAAN
                        </p>
                        <p style="color:var(--text-dim); font-size:0.9rem; text-align:left;">
                            1. Untuk scanning QR, arahkan kamera ke kode QR item inventaris<br>
                            2. Untuk foto laporan K3, pastikan area cukup terang<br>
                            3. Foto otomatis diberi watermark "Al-Fikri Security"<br>
                            4. Gunakan kamera belakang untuk hasil terbaik
                        </p>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                        <button onclick="showDashboard()" class="btn" style="background:var(--danger); color:white; width:100%;">
                            <i class="fas fa-times"></i> TUTUP SCANNER
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('dynamicTitle').textContent = 'Quantum Scanner';
        }

        function startCameraScanner(mode) {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showToast('Kamera tidak didukung di perangkat ini', 'error');
                return;
            }
            
            const container = document.getElementById('moduleContent');
            container.innerHTML = `
                <div style="padding: 1rem; text-align: center;">
                    <h3 style="color:var(--gold-primary); margin-bottom:1rem;">
                        <i class="fas fa-${mode === 'inventory' ? 'qrcode' : 'camera'}"></i> 
                        ${mode === 'inventory' ? 'QR SCANNER' : 'K3 CAMERA'}
                    </h3>
                    
                    <div style="position:relative; width:100%; max-width:400px; margin:0 auto; border:3px solid var(--gold-primary); border-radius:20px; overflow:hidden; background:#000;">
                        <video id="videoPreview" autoplay playsinline style="width:100%; display:block;"></video>
                        <div id="scanOverlay" style="position:absolute; inset:0; border:2px solid rgba(251,191,36,0.5); box-shadow: inset 0 0 100px rgba(0,0,0,0.5);"></div>
                    </div>
                    
                    <div style="margin-top:1.5rem; display:flex; gap:10px; justify-content:center;">
                        <button onclick="stopCameraScanner()" class="btn" style="background:var(--danger); color:white;">
                            <i class="fas fa-times"></i> BATAL
                        </button>
                        ${mode === 'k3' ? 
                            `<button onclick="capturePhoto()" class="btn btn-success">
                                <i class="fas fa-camera"></i> AMBIL FOTO
                            </button>` : 
                            `<div style="color:var(--gold-primary); font-size:0.9rem; padding:10px;">
                                Arahkan kamera ke QR Code...
                            </div>`
                        }
                    </div>
                    
                    <div id="photoResult" style="margin-top:20px;"></div>
                </div>
            `;
            
            // Start camera
            navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment" } 
            })
            .then(stream => {
                const video = document.getElementById('videoPreview');
                video.srcObject = stream;
                
                if (mode === 'inventory') {
                    // Simple QR simulation (in real app, use a QR library)
                    setTimeout(() => {
                        showToast('QR Code berhasil dipindai!', 'success');
                        simulateQRScan();
                    }, 2000);
                }
            })
            .catch(err => {
                showToast('Gagal mengakses kamera: ' + err.message, 'error');
                showDashboard();
            });
        }

        function stopCameraScanner() {
            const video = document.getElementById('videoPreview');
            if (video && video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
            }
            showDashboard();
        }

        function capturePhoto() {
            const video = document.getElementById('videoPreview');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Draw camera image
            ctx.drawImage(video, 0, 0);
            
            // Add watermark
            ctx.font = "bold 20px Arial";
            ctx.fillStyle = "rgba(251, 191, 36, 0.7)";
            ctx.fillText("üöÄ DREAM OS v13.0 | AL-FIKRI SECURITY", 20, canvas.height - 50);
            ctx.font = "15px Arial";
            ctx.fillText(new Date().toLocaleString('id-ID'), 20, canvas.height - 25);
            
            // Convert to data URL
            const photoData = canvas.toDataURL('image/jpeg', 0.7);
            
            // Display result
            document.getElementById('photoResult').innerHTML = `
                <p style="color:var(--success); margin-bottom:10px;">‚úÖ Foto berhasil diambil dengan watermark!</p>
                <img src="${photoData}" style="width:100%; border-radius:12px; border:2px solid var(--gold-primary); margin-bottom:15px;">
                <button onclick="saveK3Photo('${photoData}')" class="btn btn-primary btn-block">
                    <i class="fas fa-save"></i> SIMPAN SEBAGAI LAPORAN K3
                </button>
            `;
            
            // Stop camera
            stopCameraScanner();
        }

        function saveK3Photo(photoData) {
            // In a real app, this would upload to server
            // For now, we'll just save to localStorage
            const photoReports = JSON.parse(localStorage.getItem('DREAMOS_K3_PHOTOS')) || [];
            photoReports.unshift({
                id: 'PHOTO-' + Date.now(),
                data: photoData,
                date: new Date().toISOString(),
                location: 'Manual Capture'
            });
            
            localStorage.setItem('DREAMOS_K3_PHOTOS', JSON.stringify(photoReports));
            showSpiritualToast('Foto berhasil disimpan ke laporan K3!');
            openModule('k3');
        }

        function simulateQRScan() {
            // Simulate QR scan result
            const items = [
                "Proyektor Utama - LAB 01",
                "Sound System Portable",
                "Kamera Dokumentasi",
                "Laptop Presentasi"
            ];
            const randomItem = items[Math.floor(Math.random() * items.length)];
            
            const container = document.getElementById('moduleContent');
            container.innerHTML = `
                <div style="padding: 1rem; text-align: center;">
                    <div style="color:var(--success); font-size:4rem; margin-bottom:1rem;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 style="color:var(--gold-primary); margin-bottom:1rem;">SCAN BERHASIL!</h3>
                    
                    <div style="background:rgba(16,185,129,0.1); padding:20px; border-radius:12px; margin-bottom:20px; border:2px solid var(--success);">
                        <div style="font-weight:800; color:var(--success); margin-bottom:10px;">ITEM TERDETEKSI:</div>
                        <div style="font-size:1.2rem; color:white; margin-bottom:15px;">${randomItem}</div>
                        <div style="font-size:0.9rem; color:var(--text-dim);">
                            Status: <span class="badge badge-success">TERSEDIA</span>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                        <button onclick="checkOutItem('${randomItem}')" class="btn btn-primary">
                            <i class="fas fa-sign-out-alt"></i> CHECK OUT
                        </button>
                        <button onclick="showDashboard()" class="btn" style="background:var(--info); color:white;">
                            <i class="fas fa-info-circle"></i> DETAIL
                        </button>
                    </div>
                    
                    <button onclick="startCameraScanner('inventory')" class="btn btn-success btn-block">
                        <i class="fas fa-redo"></i> SCAN LAGI
                    </button>
                </div>
            `;
            
            // Stop camera
            stopCameraScanner();
        }

        function checkOutItem(itemName) {
            showSpiritualToast(`${itemName} berhasil di-check out!`);
            showDashboard();
        }

        // ========== UTILITY FUNCTIONS ==========
        function showHrdForm() {
            showToast('Fitur HRD akan segera hadir di versi berikutnya', 'info');
        }

        function showSettings() {
            const container = document.getElementById('moduleContent');
            container.innerHTML = `
                <div style="padding: 1rem;">
                    <h3 style="color:var(--gold-primary); margin-bottom:1rem;">
                        <i class="fas fa-cog"></i> System Settings
                    </h3>
                    
                    <div style="background:var(--bg-card); padding:1rem; border-radius:12px; margin-bottom:15px;">
                        <div style="font-weight:700; color:var(--gold-primary); margin-bottom:10px;">
                            <i class="fas fa-user"></i> Account Information
                        </div>
                        <div style="font-size:0.9rem; color:var(--text-dim);">
                            Role: <span id="userRoleDisplay">${STATE.userRole || 'GUEST'}</span><br>
                            Device ID: <span id="deviceIdDisplay">${localStorage.getItem('DREAMOS_AUTHORIZED_DEVICE') || 'Not registered'}</span><br>
                            Login Time: <span id="loginTimeDisplay">${sessionStorage.getItem('dreamos_login_time') ? new Date(sessionStorage.getItem('dreamos_login_time')).toLocaleString('id-ID') : 'N/A'}</span>
                        </div>
                    </div>
                    
                    <div style="background:var(--bg-card); padding:1rem; border-radius:12px; margin-bottom:15px;">
                        <div style="font-weight:700; color:var(--gold-primary); margin-bottom:10px;">
                            <i class="fas fa-bell"></i> Notifications
                        </div>
                        <div style="font-size:0.9rem;">
                            <label style="display:flex; justify-content:space-between; margin-bottom:10px;">
                                <span>Shalawat Reminder</span>
                                <input type="checkbox" checked>
                            </label>
                            <label style="display:flex; justify-content:space-between; margin-bottom:10px;">
                                <span>Booking Alerts</span>
                                <input type="checkbox" checked>
                            </label>
                            <label style="display:flex; justify-content:space-between;">
                                <span>Security Updates</span>
                                <input type="checkbox" checked>
                            </label>
                        </div>
                    </div>
                    
                    <div style="background:var(--bg-card); padding:1rem; border-radius:12px; margin-bottom:20px;">
                        <div style="font-weight:700; color:var(--gold-primary); margin-bottom:10px;">
                            <i class="fas fa-database"></i> Data Management
                        </div>
                        <div style="font-size:0.9rem;">
                            <button onclick="exportData()" class="btn" style="width:100%; margin-bottom:10px; background:var(--info); color:white;">
                                <i class="fas fa-download"></i> Export Data
                            </button>
                            <button onclick="clearLocalData()" class="btn" style="width:100%; background:var(--danger); color:white;">
                                <i class="fas fa-trash"></i> Clear Local Data
                            </button>
                        </div>
                    </div>
                    
                    <button onclick="logout()" class="btn btn-danger btn-block">
                        <i class="fas fa-sign-out-alt"></i> LOGOUT
                    </button>
                </div>
            `;
            document.getElementById('dynamicTitle').textContent = 'Settings';
        }

        function exportData() {
            const data = {
                bookings: STATE.bookingData,
                k3Reports: STATE.k3Data,
                securityReports: STATE.securityData,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `dreamos_export_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('Data berhasil di-export!', 'success');
        }

        function clearLocalData() {
            if (confirm('Hapus semua data lokal? Tindakan ini tidak bisa dibatalkan!')) {
                localStorage.clear();
                sessionStorage.clear();
                showToast('Semua data lokal telah dihapus', 'success');
                setTimeout(() => location.reload(), 1000);
            }
        }

        function logout() {
            if (confirm('Anda yakin ingin logout?')) {
                sessionStorage.clear();
                location.reload();
            }
        }

        function triggerSOS() {
            if (confirm('Kirim SOS Emergency ke Admin?')) {
                showToast('üÜò SOS Emergency terkirim ke Admin!', 'error');
                // Haptic feedback
                if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 100]);
            }
        }

        function sendShalawat() {
            STATE.shalawatCount++;
            
            // Update shalawat text in footer
            const shalawatTexts = [
                "ÿßŸéŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸéŸâ ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç ŸàŸéÿπŸéŸÑŸéŸâ ÿ¢ŸÑŸê ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç",
                "ÿßŸéŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ®Ÿéÿßÿ±ŸêŸÉŸí ÿπŸéŸÑŸéŸâ ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç ŸàŸéÿπŸéŸÑŸéŸâ ÿ¢ŸÑŸê ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç",
                "ÿµŸéŸÑŸéŸëŸâ ÿßŸÑŸÑŸáŸè ÿπŸéŸÑŸéŸâ ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸçÿå ÿµŸéŸÑŸéŸëŸâ ÿßŸÑŸÑŸáŸè ÿπŸéŸÑŸéŸäŸíŸáŸê ŸàŸéÿ≥ŸéŸÑŸéŸëŸÖŸé"
            ];
            const translations = [
                "Ya Allah, limpahkan shalawat kepada junjungan kami Nabi Muhammad",
                "Ya Allah, berkahilah junjungan kami Nabi Muhammad",
                "Semoga Allah memberikan shalawat kepada Nabi Muhammad"
            ];
            
            const randomIndex = Math.floor(Math.random() * shalawatTexts.length);
            document.getElementById('shalawatText').textContent = shalawatTexts[randomIndex];
            document.getElementById('shalawatTranslation').textContent = translations[randomIndex];
            
            showSpiritualToast('ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸéŸâ ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç');
        }

        function startVoiceCommand() {
            showToast('Voice Command akan segera hadir di versi berikutnya', 'info');
        }

        function showQuantumDashboard() {
            openModule('quantum');
        }

        function updateAuditTimestamp() {
            const now = new Date();
            const formatted = now.toLocaleString('id-ID', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const element = document.getElementById('auditTimestamp');
            if (element) {
                element.textContent = `Last updated: ${formatted}`;
            }
        }

        // ========== 1. MODULE DEVICE SECURITY (WAJIB ADA) ==========
const DeviceSecurity = {
    generateDeviceId: function() {
        const navigator_info = window.navigator.userAgent;
        const screen_info = window.screen.width + "x" + window.screen.height;
        const hardware_concurrency = window.navigator.hardwareConcurrency || 'unknown';
        const rawId = `${navigator_info}|${screen_info}|${hardware_concurrency}`;
        return "DEV-" + btoa(rawId).substring(0, 12).toUpperCase();
    },
    verifyDevice: function() {
        const currentId = this.generateDeviceId();
        const authorizedId = localStorage.getItem('DREAMOS_AUTHORIZED_DEVICE');
        if (!authorizedId && STATE.userRole === 'architect') {
            localStorage.setItem('DREAMOS_AUTHORIZED_DEVICE', currentId);
            return { id: currentId, status: 'AUTHORIZED_NOW' };
        }
        return (currentId === authorizedId) ? { id: currentId, status: 'MATCHED' } : { id: currentId, status: 'NEW_DEVICE' };
    }
};

// ========== 2. FUNGSI MATA (SUNTIKAN BARU) ==========
function togglePassword(inputId, iconId) {
    const input = document.getElementById(inputId);
    const icon = document.getElementById(iconId);
    if (input && icon) {
        if (input.type === "password") {
            input.type = "text";
            icon.className = "fas fa-eye-slash";
        } else {
            input.type = "password";
            icon.className = "fas fa-eye";
        }
    }
}

// ========== 3. ROUTER SHORTCUT PWA ==========
function handleShortcuts() {
    const urlParams = new URLSearchParams(window.location.search);
    const shortcut = urlParams.get('shortcut');
    if (shortcut) {
        setTimeout(() => {
            if (shortcut === 'booking') openModule('booking');
            if (shortcut === 'k3') openModule('k3');
            if (shortcut === 'scanner') openScanner();
        }, 800);
    }
}

// ========== 4. INITIALIZATION (VERSI REVISI) ==========
function initSystem() {
    console.log('üöÄ Initializing DREAM OS v13.0...');
    const deviceCheck = DeviceSecurity.verifyDevice();
    STATE.deviceId = deviceCheck.id;

    const loggedIn = sessionStorage.getItem('dreamos_logged_in');
    const userRole = sessionStorage.getItem('dreamos_user_role');
    const deviceId = sessionStorage.getItem('dreamos_device_id');
    
    if (loggedIn === 'true' && userRole && deviceId) {
        if (deviceCheck.id === deviceId || userRole === 'architect') {
            document.getElementById('loginGate').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            STATE.userRole = userRole;
            
            const roleIcons = { 'user': 'user', 'admin': 'crown', 'security': 'shield-alt', 'hrd': 'users', 'inventory_vault': 'key', 'warehouse_vault': 'warehouse', 'master': 'star', 'architect': 'ghost' };
            const badge = document.getElementById('userRoleBadge');
            if(badge) badge.innerHTML = `<i class="fas fa-${roleIcons[userRole] || 'user'}"></i> ${userRole.toUpperCase()}`;
            
            if (userRole === 'architect') {
                const gm = document.getElementById('ghostMenu');
                const ds = document.getElementById('deviceStatus');
                if(gm) gm.style.display = 'block';
                if(ds) {
                    ds.style.display = 'flex';
                    ds.innerHTML = `<i class="fas fa-ghost"></i> Ghost Mode`;
                }
            }
            if(window.startInactivityTimer) startInactivityTimer();
            updateSmartGreeting();
            fetchWeather();
            updateAuditTimestamp();
            showToast(`Selamat datang kembali, ${userRole.toUpperCase()}!`, 'success');
        } else {
            sessionStorage.clear();
            showToast('Device mismatch detected.', 'error');
        }
    } else {
        document.getElementById('loginGate').style.display = 'flex';
        const devIdLabel = document.getElementById('deviceId');
        if(devIdLabel) devIdLabel.textContent = deviceCheck.id;
        if (deviceCheck.status === 'NEW_DEVICE' && document.getElementById('deviceTag')) {
            document.getElementById('deviceTag').innerHTML += ' <span style="color:var(--warning);">(NEW DEVICE)</span>';
        }
    }
    updateConnectionStatus();
    handleShortcuts();
}

function updateConnectionStatus() {
    const cs = document.getElementById('connectionStatus');
    const ss = document.getElementById('syncStatus');
    if (navigator.onLine) {
        if(cs) cs.textContent = 'üü¢ Online';
        if(ss) ss.innerHTML = '<i class="fas fa-sync"></i> Online';
    } else {
        if(cs) cs.textContent = 'üì∂ Offline';
        if(ss) ss.innerHTML = '<i class="fas fa-cloud"></i> Offline';
    }
}

// ========== 5. GLOBAL EXPORTS & LISTENERS ==========
window.openModule = openModule;
window.togglePassword = togglePassword;
window.gateLogin = gateLogin;
window.openScanner = openScanner;
window.showDashboard = showDashboard;
window.triggerSOS = triggerSOS;

document.addEventListener('DOMContentLoaded', initSystem);

let ghostClickCount = 0;
document.addEventListener('click', (e) => {
    if(e.clientX > window.innerWidth - 60 && e.clientY > window.innerHeight - 60) {
        ghostClickCount++;
        if(ghostClickCount === 5) {
            const pin = prompt("üîê Ghost Console Password:");
            if(pin === "234") {
                alert("üëª Ghost Console Activated!\n\nID: " + STATE.deviceId + "\nRole: " + STATE.userRole);
            }
            ghostClickCount = 0;
        }
    } else {
        setTimeout(() => { ghostClickCount = 0; }, 3000);
    }
});

window.addEventListener('online', updateConnectionStatus);
window.addEventListener('offline', updateConnectionStatus);
setInterval(updateAuditTimestamp, 60000);
setInterval(fetchWeather, 1800000);

console.log('‚úÖ DREAM OS ISO Gold Ready to Launch!');
</script>
</body>
</html>
